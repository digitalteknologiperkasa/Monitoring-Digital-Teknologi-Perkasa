import{_ as Z,o as ee,c as l,e as t,q as z,f as m,g as E,j as U,A as te,F as A,p as j,l as b,D as u,C as q,r as i,E as r,z as V,G as ae}from"./index-DuGRLDmX.js";const se={class:"max-w-[1600px] mx-auto flex flex-col h-[calc(100vh-140px)] gap-6"},le={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},re={key:0,class:"flex flex-wrap gap-3"},oe={class:"bg-white dark:bg-[#141414] rounded-xl border border-slate-200 dark:border-gray-800 shadow-sm overflow-hidden flex flex-col flex-1 min-h-0"},de={class:"border-b border-slate-200 dark:border-gray-800 px-6 py-4 flex flex-wrap items-center justify-between bg-slate-50/50 dark:bg-[#1a1a1a]/50 gap-4"},ne={class:"flex items-center gap-4 flex-1 min-w-0"},ie={class:"relative w-full sm:w-64"},ue={class:"overflow-auto flex-1 custom-scrollbar"},ce={class:"w-full border-collapse text-left min-w-[1000px]"},pe={class:"bg-slate-50 dark:bg-slate-900 sticky top-0 z-20 shadow-sm"},be={class:"flex flex-col items-center gap-2"},me={class:"inline-flex items-center justify-center bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 px-2 py-1 rounded text-[10px] font-black shadow-sm uppercase whitespace-nowrap border border-slate-200 dark:border-slate-700"},fe={class:"truncate max-w-[100px]"},xe={key:0,class:"flex gap-2 opacity-0 group-hover/role:opacity-100 transition-opacity"},ve=["onClick"],ge=["onClick"],ke={class:"divide-y divide-slate-200 dark:divide-slate-700 text-sm bg-white dark:bg-slate-800"},he={key:0},_e=["colspan"],ye={key:1},we=["colspan"],Ce={class:"sticky left-0 z-10 border-r border-slate-200 dark:border-slate-700 px-6 py-4 font-medium text-slate-900 dark:text-slate-200 bg-white dark:bg-slate-800 group-hover:bg-slate-50 dark:group-hover:bg-slate-700/30 transition-colors shadow-[4px_0_8px_-4px_rgba(0,0,0,0.05)] group/module"},Me={class:"flex items-center justify-between gap-3"},ze={class:"flex items-center gap-3"},Ae={class:"material-symbols-outlined text-slate-400 text-lg"},Ee={key:0,class:"flex gap-2 opacity-0 group-hover/module:opacity-100 transition-opacity"},je=["onClick"],Re=["onClick"],Ne=["onClick"],Ue={class:"flex justify-center items-center gap-1.5 h-full"},Ve={key:0,class:"text-[11px] w-3 text-slate-900 dark:text-white font-black"},$e={key:1,class:"w-[13px] h-[5px] bg-slate-600 dark:bg-slate-500 rounded-full opacity-60"},De={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm"},Se={class:"bg-white dark:bg-[#141414] w-full max-w-md rounded-2xl shadow-2xl border border-slate-200 dark:border-gray-800 overflow-hidden animate-in zoom-in duration-200"},Ie={class:"px-6 py-4 border-b border-slate-100 dark:border-gray-800 flex items-center justify-between bg-slate-50 dark:bg-[#1a1a1a]/50"},Be={class:"font-bold text-slate-800 dark:text-white"},Te={class:"p-6 space-y-4"},Pe={class:"space-y-1.5"},qe={class:"space-y-1.5"},Fe={class:"px-6 py-4 border-t border-slate-100 dark:border-gray-800 flex justify-end gap-3 bg-slate-50 dark:bg-[#1a1a1a]/50"},Le=["disabled"],He={key:0,class:"animate-spin size-4 border-2 border-white/30 border-t-white rounded-full inline-block align-middle mr-2"},Ge={key:1,class:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm"},Ke={class:"bg-white dark:bg-[#141414] w-full max-w-md rounded-2xl shadow-2xl border border-slate-200 dark:border-gray-800 overflow-hidden animate-in zoom-in duration-200"},Oe={class:"px-6 py-4 border-b border-slate-100 dark:border-gray-800 flex items-center justify-between bg-slate-50 dark:bg-[#1a1a1a]/50"},Qe={class:"font-bold text-slate-800 dark:text-white"},Je={class:"p-6 space-y-4"},We={class:"space-y-1.5"},Xe={class:"px-6 py-4 border-t border-slate-100 dark:border-gray-800 flex justify-end gap-3 bg-slate-50 dark:bg-[#1a1a1a]/50"},Ye=["disabled"],Ze={key:0,class:"animate-spin size-4 border-2 border-white/30 border-t-white rounded-full inline-block align-middle mr-2"},et={key:2,class:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm"},tt={class:"bg-white dark:bg-[#141414] w-full max-w-md rounded-2xl shadow-2xl border border-slate-200 dark:border-gray-800 overflow-hidden animate-in zoom-in duration-200"},at={class:"px-6 py-4 border-b border-slate-100 dark:border-gray-800 bg-slate-50 dark:bg-[#1a1a1a]/50"},st={class:"font-bold text-slate-800 dark:text-white text-sm"},lt={class:"text-[10px] text-slate-500 font-bold uppercase tracking-wider"},rt={class:"p-6 grid grid-cols-2 gap-4"},ot={class:"text-xs font-bold text-slate-700 dark:text-slate-300"},dt=["onUpdate:modelValue"],nt={class:"px-6 py-4 border-t border-slate-100 dark:border-gray-800 flex justify-end gap-3 bg-slate-50 dark:bg-[#1a1a1a]/50"},it=["disabled"],ut={key:0,class:"animate-spin size-4 border-2 border-white/30 border-t-white rounded-full inline-block align-middle mr-2"},ct={__name:"AccessControl",setup(pt){const $=i(""),v=i([]),B=i([]),D=i([]),S=i(!0),R=i(!1),k=i(!1),h=i(!1),n=i(!1),_=i({roleId:null,roleName:"",moduleId:null,moduleName:"",can_create:!1,can_read:!1,can_update:!1,can_delete:!1,can_verify:!1}),f=i({role_name:"",role_code:""}),y=i({name:""}),w=i(null),C=i(null),p=i(null),x=q(()=>p.value?.role==="Super Admin"),F=async()=>{const{data:{user:a}}=await u.auth.getUser();if(a)try{const{data:e}=await u.from("profiles").select("*").eq("id",a.id).single();e&&(p.value=e)}catch(e){console.error("Error fetching current user profile:",e)}},M=async()=>{S.value=!0;try{const[a,e,s]=await Promise.all([u.from("access_roles").select("*").order("role_code"),u.from("app_components").select("*").order("name"),u.from("access_permissions").select("*")]);if(a.error)throw a.error;if(e.error)throw e.error;if(s.error)throw s.error;const d=["blue","purple","orange","teal","slate","red","green","indigo"],c=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),N=a.data.sort((o,g)=>c.compare(o.role_code||"",g.role_code||""));v.value=N.map((o,g)=>({...o,code:o.role_code||`R${g+1}`,name:o.role_name,color:d[g%d.length]})),D.value=s.data,B.value=e.data.map(o=>{const g={};return v.value.forEach(I=>{const Y=D.value.find(P=>P.role_id===I.id&&P.component_id===o.id);g[I.id]=Y||{role_id:I.id,component_id:o.id,can_create:!1,can_read:!1,can_update:!1,can_delete:!1,can_verify:!1}}),{id:o.id,name:o.name,icon:"extension",permissions:g}})}catch(a){console.error("Error fetching access matrix:",a.message)}finally{S.value=!1}},L=(a,e)=>{if(!x.value&&p.value?.role!=="Editor"){alert("Anda tidak memiliki izin untuk mengubah hak akses.");return}const s=a.permissions[e],d=v.value.find(c=>c.id===e);_.value={roleId:e,roleName:d.name,moduleId:a.id,moduleName:a.name,can_create:s.can_create||!1,can_read:s.can_read||!1,can_update:s.can_update||!1,can_delete:s.can_delete||!1,can_verify:s.can_verify||!1},R.value=!0},H=async()=>{n.value=!0;try{const{roleId:a,moduleId:e,roleName:s,moduleName:d,...c}=_.value;if(D.value.find(o=>o.role_id===a&&o.component_id===e)){const{error:o}=await u.from("access_permissions").update({...c,updated_at:new Date().toISOString()}).match({role_id:a,component_id:e});if(o)throw o}else{const{error:o}=await u.from("access_permissions").insert([{role_id:a,component_id:e,...c}]);if(o)throw o}R.value=!1,M()}catch(a){alert("Error saving: "+a.message)}finally{n.value=!1}},G=async()=>{if(!x.value&&p.value?.role!=="Editor"){alert("Anda tidak memiliki izin untuk menambah/mengedit role.");return}n.value=!0;try{if(w.value){const{error:a}=await u.from("access_roles").update(f.value).eq("id",w.value);if(a)throw a}else{const{error:a}=await u.from("access_roles").insert([f.value]);if(a)throw a}k.value=!1,w.value=null,f.value={role_name:"",role_code:""},M()}catch(a){alert(a.message)}finally{n.value=!1}},K=a=>{w.value=a.id,f.value={role_name:a.role_name,role_code:a.role_code},k.value=!0},O=async a=>{if(!x.value&&p.value?.role!=="Editor"){alert("Anda tidak memiliki izin untuk menghapus role.");return}if(confirm("Hapus role ini? Seluruh matriks hak akses untuk role ini akan hilang.")){n.value=!0;try{const{error:e}=await u.from("access_roles").delete().eq("id",a);if(e)throw e;M()}catch(e){alert(e.message)}finally{n.value=!1}}},Q=async()=>{if(!x.value&&p.value?.role!=="Editor"){alert("Anda tidak memiliki izin untuk menambah/mengedit modul.");return}n.value=!0;try{if(C.value){const{error:a}=await u.from("app_components").update(y.value).eq("id",C.value);if(a)throw a}else{const{error:a}=await u.from("app_components").insert([y.value]);if(a)throw a}h.value=!1,C.value=null,y.value={name:""},M()}catch(a){alert(a.message)}finally{n.value=!1}},J=a=>{C.value=a.id,y.value={name:a.name},h.value=!0},W=async a=>{if(!x.value&&p.value?.role!=="Editor"){alert("Anda tidak memiliki izin untuk menghapus modul.");return}if(confirm("Hapus modul ini? Seluruh matriks hak akses untuk modul ini akan hilang.")){n.value=!0;try{const{error:e}=await u.from("app_components").delete().eq("id",a);if(e)throw e;M()}catch(e){alert(e.message)}finally{n.value=!1}}};ee(()=>{F(),M()});const T=q(()=>B.value.filter(a=>a.name.toLowerCase().includes($.value.toLowerCase()))),X=a=>[{char:"C",isActive:a.can_create},{char:"R",isActive:a.can_read},{char:"U",isActive:a.can_update},{char:"D",isActive:a.can_delete},{char:"V",isActive:a.can_verify}];return(a,e)=>(r(),l("div",se,[t("div",le,[e[13]||(e[13]=t("h3",{class:"text-xl font-bold text-slate-900 dark:text-white"},"Matriks Hak Akses",-1)),x.value||p.value?.role==="Editor"?(r(),l("div",re,[t("button",{onClick:e[0]||(e[0]=s=>h.value=!0),class:"inline-flex items-center gap-2 bg-white dark:bg-[#141414] hover:bg-emerald-50 dark:hover:bg-emerald-900/20 text-emerald-600 border border-emerald-200 dark:border-emerald-800 px-4 py-2 rounded-lg text-sm font-bold shadow-sm transition-all"},[...e[11]||(e[11]=[t("span",{class:"material-symbols-outlined text-lg"},"add",-1),z(" Tambah Modul ",-1)])]),t("button",{onClick:e[1]||(e[1]=s=>k.value=!0),class:"inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-emerald-900/20 transition-all"},[...e[12]||(e[12]=[t("span",{class:"material-symbols-outlined text-lg"},"add",-1),z(" Tambah Role Baru ",-1)])])])):m("",!0)]),t("div",oe,[t("div",de,[t("div",ne,[t("div",ie,[e[14]||(e[14]=t("span",{class:"material-symbols-outlined absolute left-3 top-2 text-slate-400 text-lg"},"search",-1)),E(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>$.value=s),type:"text",placeholder:"Filter modul...",class:"pl-10 pr-4 py-1.5 w-full text-sm bg-white dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-md focus:ring-2 focus:ring-emerald-500 outline-none transition-all dark:text-slate-200"},null,512),[[U,$.value]])]),e[15]||(e[15]=te('<div class="hidden sm:flex items-center gap-4 text-[10px] font-bold uppercase tracking-wider text-slate-500" data-v-138278fd><div class="flex items-center gap-1.5" data-v-138278fd><span class="size-2 rounded-full bg-slate-900 dark:bg-white" data-v-138278fd></span><span data-v-138278fd>Aktif</span></div><div class="flex items-center gap-1.5" data-v-138278fd><div class="w-[13px] h-[5px] bg-slate-600 dark:bg-slate-400 rounded-full" data-v-138278fd></div><span data-v-138278fd>Tidak Aktif</span></div></div>',1))])]),t("div",ue,[t("table",ce,[t("thead",pe,[t("tr",null,[e[18]||(e[18]=t("th",{class:"sticky left-0 z-30 border-b border-r border-slate-200 dark:border-slate-700 px-6 py-4 text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 w-[280px] min-w-[280px] bg-slate-50 dark:bg-slate-900"}," Modul & Entitas Data ",-1)),(r(!0),l(A,null,j(v.value,s=>(r(),l("th",{key:s.id,class:"border-b border-slate-200 dark:border-slate-700 px-4 py-4 text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 text-center w-[120px] group/role"},[t("div",be,[t("span",me,b(s.role_code||s.id.substring(0,2)),1),t("span",fe,b(s.name),1),x.value||p.value?.role==="Editor"?(r(),l("div",xe,[t("button",{onClick:V(d=>K(s),["stop"]),class:"size-6 flex items-center justify-center rounded-md bg-blue-50 dark:bg-blue-900/20 text-blue-600 hover:bg-blue-600 hover:text-white transition-all"},[...e[16]||(e[16]=[t("span",{class:"material-symbols-outlined text-[14px]"},"edit",-1)])],8,ve),t("button",{onClick:V(d=>O(s.id),["stop"]),class:"size-6 flex items-center justify-center rounded-md bg-rose-50 dark:bg-rose-900/20 text-rose-600 hover:bg-rose-600 hover:text-white transition-all"},[...e[17]||(e[17]=[t("span",{class:"material-symbols-outlined text-[14px]"},"delete",-1)])],8,ge)])):m("",!0)])]))),128))])]),t("tbody",ke,[S.value?(r(),l("tr",he,[t("td",{colspan:v.value.length+1,class:"px-6 py-20 text-center"},[...e[19]||(e[19]=[t("div",{class:"flex flex-col items-center gap-3"},[t("div",{class:"animate-spin size-8 border-4 border-emerald-500/30 border-t-emerald-500 rounded-full"}),t("span",{class:"text-slate-500 font-bold animate-pulse"},"Menghubungkan ke Database...")],-1)])],8,_e)])):T.value.length===0?(r(),l("tr",ye,[t("td",{colspan:v.value.length+1,class:"px-6 py-20 text-center"},[...e[20]||(e[20]=[t("div",{class:"flex flex-col items-center gap-3 opacity-40"},[t("span",{class:"material-symbols-outlined text-4xl"},"inventory_2"),t("span",{class:"text-slate-500 font-bold"},"Tidak ada modul yang ditemukan")],-1)])],8,we)])):(r(!0),l(A,{key:2},j(T.value,s=>(r(),l("tr",{key:s.id,class:"hover:bg-slate-50 dark:hover:bg-slate-700/30 group transition-colors"},[t("td",Ce,[t("div",Me,[t("div",ze,[t("span",Ae,b(s.icon),1),z(" "+b(s.name),1)]),x.value||p.value?.role==="Editor"?(r(),l("div",Ee,[t("button",{onClick:V(d=>J(s),["stop"]),class:"size-6 flex items-center justify-center rounded-md bg-blue-50 dark:bg-blue-900/20 text-blue-600 hover:bg-blue-600 hover:text-white transition-all"},[...e[21]||(e[21]=[t("span",{class:"material-symbols-outlined text-[14px]"},"edit",-1)])],8,je),t("button",{onClick:V(d=>W(s.id),["stop"]),class:"size-6 flex items-center justify-center rounded-md bg-rose-50 dark:bg-rose-900/20 text-rose-600 hover:bg-rose-600 hover:text-white transition-all"},[...e[22]||(e[22]=[t("span",{class:"material-symbols-outlined text-[14px]"},"delete",-1)])],8,Re)])):m("",!0)])]),(r(!0),l(A,null,j(v.value,d=>(r(),l("td",{key:d.id,onClick:c=>L(s,d.id),class:"px-2 py-4 text-center cursor-pointer hover:bg-emerald-50/50 dark:hover:bg-emerald-900/10 transition-colors border-r border-slate-100 dark:border-slate-700"},[t("div",Ue,[(r(!0),l(A,null,j(X(s.permissions[d.id]),(c,N)=>(r(),l(A,{key:N},[c.isActive?(r(),l("span",Ve,b(c.char),1)):(r(),l("div",$e))],64))),128))])],8,Ne))),128))]))),128))])])])]),k.value?(r(),l("div",De,[t("div",Se,[t("div",Ie,[t("h4",Be,b(w.value?"Edit Role":"Tambah Role Baru"),1),t("button",{onClick:e[3]||(e[3]=s=>(k.value=!1,w.value=null)),class:"text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"},[...e[23]||(e[23]=[t("span",{class:"material-symbols-outlined"},"close",-1)])])]),t("div",Te,[t("div",Pe,[e[24]||(e[24]=t("label",{class:"text-xs font-bold text-slate-500 uppercase"},"Nama Role",-1)),E(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>f.value.role_name=s),type:"text",placeholder:"e.g. Project Manager",class:"w-full bg-slate-50 dark:bg-[#1c1c1c] border border-slate-200 dark:border-gray-800 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-emerald-500 outline-none"},null,512),[[U,f.value.role_name]])]),t("div",qe,[e[25]||(e[25]=t("label",{class:"text-xs font-bold text-slate-500 uppercase"},"Kode Role (Singkatan)",-1)),E(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>f.value.role_code=s),type:"text",placeholder:"e.g. PM",class:"w-full bg-slate-50 dark:bg-[#1c1c1c] border border-slate-200 dark:border-gray-800 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-emerald-500 outline-none uppercase"},null,512),[[U,f.value.role_code]])])]),t("div",Fe,[t("button",{onClick:e[6]||(e[6]=s=>k.value=!1),class:"px-4 py-2 text-sm font-bold text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-white transition-colors"},"Batal"),t("button",{onClick:G,disabled:n.value,class:"px-6 py-2 text-sm font-bold text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 transition-all disabled:opacity-50"},[n.value?(r(),l("span",He)):m("",!0),e[26]||(e[26]=z(" Simpan Role ",-1))],8,Le)])])])):m("",!0),h.value?(r(),l("div",Ge,[t("div",Ke,[t("div",Oe,[t("h4",Qe,b(C.value?"Edit Modul":"Tambah Modul/Entitas"),1),t("button",{onClick:e[7]||(e[7]=s=>(h.value=!1,C.value=null)),class:"text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"},[...e[27]||(e[27]=[t("span",{class:"material-symbols-outlined"},"close",-1)])])]),t("div",Je,[t("div",We,[e[28]||(e[28]=t("label",{class:"text-xs font-bold text-slate-500 uppercase"},"Nama Modul",-1)),E(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>y.value.name=s),type:"text",placeholder:"e.g. Inventaris Barang",class:"w-full bg-slate-50 dark:bg-[#1c1c1c] border border-slate-200 dark:border-gray-800 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-emerald-500 outline-none"},null,512),[[U,y.value.name]])])]),t("div",Xe,[t("button",{onClick:e[9]||(e[9]=s=>h.value=!1),class:"px-4 py-2 text-sm font-bold text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-white transition-colors"},"Batal"),t("button",{onClick:Q,disabled:n.value,class:"px-6 py-2 text-sm font-bold text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 transition-all disabled:opacity-50"},[n.value?(r(),l("span",Ze)):m("",!0),e[29]||(e[29]=z(" Simpan Modul ",-1))],8,Ye)])])])):m("",!0),R.value?(r(),l("div",et,[t("div",tt,[t("div",at,[t("h4",st,"Update Izin: "+b(_.value.roleName),1),t("p",lt,"Modul: "+b(_.value.moduleName),1)]),t("div",rt,[(r(),l(A,null,j({can_create:"Create (C)",can_read:"Read (R)",can_update:"Update (U)",can_delete:"Delete (D)",can_verify:"Verify (V)"},(s,d)=>t("label",{key:d,class:"flex items-center justify-between p-3 rounded-xl border border-slate-100 dark:border-gray-800 bg-slate-50 dark:bg-[#1c1c1c] cursor-pointer hover:border-emerald-500/50 transition-all"},[t("span",ot,b(s),1),E(t("input",{type:"checkbox","onUpdate:modelValue":c=>_.value[d]=c,class:"size-4 accent-emerald-600 cursor-pointer"},null,8,dt),[[ae,_.value[d]]])])),64))]),t("div",nt,[t("button",{onClick:e[10]||(e[10]=s=>R.value=!1),class:"px-4 py-2 text-sm font-bold text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-white transition-colors"},"Batal"),t("button",{onClick:H,disabled:n.value,class:"px-6 py-2 text-sm font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-all disabled:opacity-50 shadow-lg shadow-blue-500/20"},[n.value?(r(),l("span",ut)):m("",!0),e[30]||(e[30]=z(" Update Akses ",-1))],8,it)])])])):m("",!0)]))}},mt=Z(ct,[["__scopeId","data-v-138278fd"]]);export{mt as default};
