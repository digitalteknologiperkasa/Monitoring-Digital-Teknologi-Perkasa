import{_ as te,u as ae,o as se,c as l,e as t,q as A,f as x,g as E,j as U,A as le,F as j,p as R,l as m,D as c,C as F,r as d,E as r,z as V,G as re}from"./index-NIutoueR.js";const oe={class:"max-w-[1600px] mx-auto flex flex-col h-[calc(100vh-140px)] gap-6"},ne={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},de={key:0,class:"flex flex-wrap gap-3"},ie={class:"bg-white dark:bg-[#141414] rounded-xl border border-slate-200 dark:border-gray-800 shadow-sm overflow-hidden flex flex-col flex-1 min-h-0"},ce={class:"border-b border-slate-200 dark:border-gray-800 px-6 py-4 flex flex-wrap items-center justify-between bg-slate-50/50 dark:bg-[#1a1a1a]/50 gap-4"},ue={class:"flex items-center gap-4 flex-1 min-w-0"},pe={class:"relative w-full sm:w-64"},be={class:"overflow-auto flex-1 custom-scrollbar"},me={class:"w-full border-collapse text-left min-w-[1000px]"},xe={class:"bg-slate-50 dark:bg-slate-900 sticky top-0 z-20 shadow-sm"},fe={class:"flex flex-col items-center gap-2"},ve={class:"inline-flex items-center justify-center bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 px-2 py-1 rounded text-[10px] font-black shadow-sm uppercase whitespace-nowrap border border-slate-200 dark:border-slate-700"},ge={class:"truncate max-w-[100px]"},he={key:0,class:"flex gap-2 opacity-0 group-hover/role:opacity-100 transition-opacity"},ke=["onClick"],_e=["onClick"],ye={class:"divide-y divide-slate-200 dark:divide-slate-700 text-sm bg-white dark:bg-slate-800"},we={key:0},Ce=["colspan"],Me={key:1},ze=["colspan"],Ae={class:"sticky left-0 z-10 border-r border-slate-200 dark:border-slate-700 px-6 py-4 font-medium text-slate-900 dark:text-slate-200 bg-white dark:bg-slate-800 group-hover:bg-slate-50 dark:group-hover:bg-slate-700/30 transition-colors shadow-[4px_0_8px_-4px_rgba(0,0,0,0.05)] group/module"},je={class:"flex items-center justify-between gap-3"},Ee={class:"flex items-center gap-3"},Re={class:"material-symbols-outlined text-slate-400 text-lg"},Ne={key:0,class:"flex gap-2 opacity-0 group-hover/module:opacity-100 transition-opacity"},Se=["onClick"],Ue=["onClick"],Ve=["onClick"],$e={class:"flex justify-center items-center gap-1.5 h-full"},De={key:0,class:"text-[11px] w-3 text-slate-900 dark:text-white font-black"},Ie={key:1,class:"w-[13px] h-[5px] bg-slate-600 dark:bg-slate-500 rounded-full opacity-60"},Be={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm"},Te={class:"bg-white dark:bg-[#141414] w-full max-w-md rounded-2xl shadow-2xl border border-slate-200 dark:border-gray-800 overflow-hidden animate-in zoom-in duration-200"},qe={class:"px-6 py-4 border-b border-slate-100 dark:border-gray-800 flex items-center justify-between bg-slate-50 dark:bg-[#1a1a1a]/50"},Pe={class:"font-bold text-slate-800 dark:text-white"},Fe={class:"p-6 space-y-4"},Le={class:"space-y-1.5"},He={class:"space-y-1.5"},Ge={class:"px-6 py-4 border-t border-slate-100 dark:border-gray-800 flex justify-end gap-3 bg-slate-50 dark:bg-[#1a1a1a]/50"},Ke=["disabled"],Oe={key:0,class:"animate-spin size-4 border-2 border-white/30 border-t-white rounded-full inline-block align-middle mr-2"},Qe={key:1,class:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm"},Je={class:"bg-white dark:bg-[#141414] w-full max-w-md rounded-2xl shadow-2xl border border-slate-200 dark:border-gray-800 overflow-hidden animate-in zoom-in duration-200"},We={class:"px-6 py-4 border-b border-slate-100 dark:border-gray-800 flex items-center justify-between bg-slate-50 dark:bg-[#1a1a1a]/50"},Xe={class:"font-bold text-slate-800 dark:text-white"},Ye={class:"p-6 space-y-4"},Ze={class:"space-y-1.5"},et={class:"px-6 py-4 border-t border-slate-100 dark:border-gray-800 flex justify-end gap-3 bg-slate-50 dark:bg-[#1a1a1a]/50"},tt=["disabled"],at={key:0,class:"animate-spin size-4 border-2 border-white/30 border-t-white rounded-full inline-block align-middle mr-2"},st={key:2,class:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm"},lt={class:"bg-white dark:bg-[#141414] w-full max-w-md rounded-2xl shadow-2xl border border-slate-200 dark:border-gray-800 overflow-hidden animate-in zoom-in duration-200"},rt={class:"px-6 py-4 border-b border-slate-100 dark:border-gray-800 bg-slate-50 dark:bg-[#1a1a1a]/50"},ot={class:"font-bold text-slate-800 dark:text-white text-sm"},nt={class:"text-[10px] text-slate-500 font-bold uppercase tracking-wider"},dt={class:"p-6 grid grid-cols-2 gap-4"},it={class:"text-xs font-bold text-slate-700 dark:text-slate-300"},ct=["onUpdate:modelValue"],ut={class:"px-6 py-4 border-t border-slate-100 dark:border-gray-800 flex justify-end gap-3 bg-slate-50 dark:bg-[#1a1a1a]/50"},pt=["disabled"],bt={key:0,class:"animate-spin size-4 border-2 border-white/30 border-t-white rounded-full inline-block align-middle mr-2"},mt={__name:"AccessControl",setup(xt){const L=ae(),$=d(""),g=d([]),T=d([]),D=d([]),I=d(!0),N=d(!1),k=d(!1),_=d(!1),n=d(!1),y=d({roleId:null,roleName:"",moduleId:null,moduleName:"",can_create:!1,can_read:!1,can_update:!1,can_delete:!1,can_verify:!1}),f=d({role_name:"",role_code:""}),w=d({name:""}),C=d(null),M=d(null),u=d(null),v=F(()=>u.value?.role==="Super Admin"),H=async()=>{const{data:{user:a}}=await c.auth.getUser();if(a)try{const{data:e}=await c.from("profiles").select("*").eq("id",a.id).single();e&&(u.value=e)}catch(e){console.error("Error fetching current user profile:",e)}},z=async()=>{I.value=!0;try{const a=L.user?.project_id||1,[e,s,o]=await Promise.all([c.from("access_roles").select("*").order("role_code"),c.from("app_components").select("*").eq("project_id",a).order("name"),c.from("access_permissions").select("*")]);if(e.error)throw e.error;if(s.error)throw s.error;if(o.error)throw o.error;const i=["blue","purple","orange","teal","slate","red","green","indigo"],S=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),p=e.data.sort((b,h)=>S.compare(b.role_code||"",h.role_code||""));g.value=p.map((b,h)=>({...b,code:b.role_code||`R${h+1}`,name:b.role_name,color:i[h%i.length]})),D.value=o.data,T.value=s.data.map(b=>{const h={};return g.value.forEach(B=>{const ee=D.value.find(P=>P.role_id===B.id&&P.component_id===b.id);h[B.id]=ee||{role_id:B.id,component_id:b.id,can_create:!1,can_read:!1,can_update:!1,can_delete:!1,can_verify:!1}}),{id:b.id,name:b.name,icon:"extension",permissions:h}})}catch(a){console.error("Error fetching access matrix:",a.message)}finally{I.value=!1}},G=(a,e)=>{if(!v.value&&u.value?.role!=="Editor"){alert("Anda tidak memiliki izin untuk mengubah hak akses.");return}const s=a.permissions[e],o=g.value.find(i=>i.id===e);y.value={roleId:e,roleName:o.name,moduleId:a.id,moduleName:a.name,can_create:s.can_create||!1,can_read:s.can_read||!1,can_update:s.can_update||!1,can_delete:s.can_delete||!1,can_verify:s.can_verify||!1},N.value=!0},K=async()=>{n.value=!0;try{const{roleId:a,moduleId:e,roleName:s,moduleName:o,...i}=y.value;if(D.value.find(p=>p.role_id===a&&p.component_id===e)){const{error:p}=await c.from("access_permissions").update({...i,updated_at:new Date().toISOString()}).match({role_id:a,component_id:e});if(p)throw p}else{const{error:p}=await c.from("access_permissions").insert([{role_id:a,component_id:e,...i}]);if(p)throw p}N.value=!1,z()}catch(a){alert("Error saving: "+a.message)}finally{n.value=!1}},O=async()=>{if(!v.value&&u.value?.role!=="Editor"){alert("Anda tidak memiliki izin untuk menambah/mengedit role.");return}n.value=!0;try{if(C.value){const{error:a}=await c.from("access_roles").update(f.value).eq("id",C.value);if(a)throw a}else{const{error:a}=await c.from("access_roles").insert([f.value]);if(a)throw a}k.value=!1,C.value=null,f.value={role_name:"",role_code:""},z()}catch(a){alert(a.message)}finally{n.value=!1}},Q=a=>{C.value=a.id,f.value={role_name:a.role_name,role_code:a.role_code},k.value=!0},J=async a=>{if(!v.value&&u.value?.role!=="Editor"){alert("Anda tidak memiliki izin untuk menghapus role.");return}if(confirm("Hapus role ini? Seluruh matriks hak akses untuk role ini akan hilang.")){n.value=!0;try{const{error:e}=await c.from("access_roles").delete().eq("id",a);if(e)throw e;z()}catch(e){alert(e.message)}finally{n.value=!1}}},W=async()=>{if(!v.value&&u.value?.role!=="Editor"){alert("Anda tidak memiliki izin untuk menambah/mengedit modul.");return}n.value=!0;try{if(M.value){const{error:a}=await c.from("app_components").update(w.value).eq("id",M.value);if(a)throw a}else{const{error:a}=await c.from("app_components").insert([w.value]);if(a)throw a}_.value=!1,M.value=null,w.value={name:""},z()}catch(a){alert(a.message)}finally{n.value=!1}},X=a=>{M.value=a.id,w.value={name:a.name},_.value=!0},Y=async a=>{if(!v.value&&u.value?.role!=="Editor"){alert("Anda tidak memiliki izin untuk menghapus modul.");return}if(confirm("Hapus modul ini? Seluruh matriks hak akses untuk modul ini akan hilang.")){n.value=!0;try{const{error:e}=await c.from("app_components").delete().eq("id",a);if(e)throw e;z()}catch(e){alert(e.message)}finally{n.value=!1}}};se(()=>{H(),z()});const q=F(()=>T.value.filter(a=>a.name.toLowerCase().includes($.value.toLowerCase()))),Z=a=>[{char:"C",isActive:a.can_create},{char:"R",isActive:a.can_read},{char:"U",isActive:a.can_update},{char:"D",isActive:a.can_delete},{char:"V",isActive:a.can_verify}];return(a,e)=>(r(),l("div",oe,[t("div",ne,[e[13]||(e[13]=t("h3",{class:"text-xl font-bold text-slate-900 dark:text-white"},"Matriks Hak Akses",-1)),v.value||u.value?.role==="Editor"?(r(),l("div",de,[t("button",{onClick:e[0]||(e[0]=s=>_.value=!0),class:"inline-flex items-center gap-2 bg-white dark:bg-[#141414] hover:bg-emerald-50 dark:hover:bg-emerald-900/20 text-emerald-600 border border-emerald-200 dark:border-emerald-800 px-4 py-2 rounded-lg text-sm font-bold shadow-sm transition-all"},[...e[11]||(e[11]=[t("span",{class:"material-symbols-outlined text-lg"},"add",-1),A(" Tambah Modul ",-1)])]),t("button",{onClick:e[1]||(e[1]=s=>k.value=!0),class:"inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-emerald-900/20 transition-all"},[...e[12]||(e[12]=[t("span",{class:"material-symbols-outlined text-lg"},"add",-1),A(" Tambah Role Baru ",-1)])])])):x("",!0)]),t("div",ie,[t("div",ce,[t("div",ue,[t("div",pe,[e[14]||(e[14]=t("span",{class:"material-symbols-outlined absolute left-3 top-2 text-slate-400 text-lg"},"search",-1)),E(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>$.value=s),type:"text",placeholder:"Filter modul...",class:"pl-10 pr-4 py-1.5 w-full text-sm bg-white dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-md focus:ring-2 focus:ring-emerald-500 outline-none transition-all dark:text-slate-200"},null,512),[[U,$.value]])]),e[15]||(e[15]=le('<div class="hidden sm:flex items-center gap-4 text-[10px] font-bold uppercase tracking-wider text-slate-500" data-v-62101c81><div class="flex items-center gap-1.5" data-v-62101c81><span class="size-2 rounded-full bg-slate-900 dark:bg-white" data-v-62101c81></span><span data-v-62101c81>Aktif</span></div><div class="flex items-center gap-1.5" data-v-62101c81><div class="w-[13px] h-[5px] bg-slate-600 dark:bg-slate-400 rounded-full" data-v-62101c81></div><span data-v-62101c81>Tidak Aktif</span></div></div>',1))])]),t("div",be,[t("table",me,[t("thead",xe,[t("tr",null,[e[18]||(e[18]=t("th",{class:"sticky left-0 z-30 border-b border-r border-slate-200 dark:border-slate-700 px-6 py-4 text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 w-[280px] min-w-[280px] bg-slate-50 dark:bg-slate-900"}," Modul & Entitas Data ",-1)),(r(!0),l(j,null,R(g.value,s=>(r(),l("th",{key:s.id,class:"border-b border-slate-200 dark:border-slate-700 px-4 py-4 text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 text-center w-[120px] group/role"},[t("div",fe,[t("span",ve,m(s.role_code||s.id.substring(0,2)),1),t("span",ge,m(s.name),1),v.value||u.value?.role==="Editor"?(r(),l("div",he,[t("button",{onClick:V(o=>Q(s),["stop"]),class:"size-6 flex items-center justify-center rounded-md bg-blue-50 dark:bg-blue-900/20 text-blue-600 hover:bg-blue-600 hover:text-white transition-all"},[...e[16]||(e[16]=[t("span",{class:"material-symbols-outlined text-[14px]"},"edit",-1)])],8,ke),t("button",{onClick:V(o=>J(s.id),["stop"]),class:"size-6 flex items-center justify-center rounded-md bg-rose-50 dark:bg-rose-900/20 text-rose-600 hover:bg-rose-600 hover:text-white transition-all"},[...e[17]||(e[17]=[t("span",{class:"material-symbols-outlined text-[14px]"},"delete",-1)])],8,_e)])):x("",!0)])]))),128))])]),t("tbody",ye,[I.value?(r(),l("tr",we,[t("td",{colspan:g.value.length+1,class:"px-6 py-20 text-center"},[...e[19]||(e[19]=[t("div",{class:"flex flex-col items-center gap-3"},[t("div",{class:"animate-spin size-8 border-4 border-emerald-500/30 border-t-emerald-500 rounded-full"}),t("span",{class:"text-slate-500 font-bold animate-pulse"},"Menghubungkan ke Database...")],-1)])],8,Ce)])):q.value.length===0?(r(),l("tr",Me,[t("td",{colspan:g.value.length+1,class:"px-6 py-20 text-center"},[...e[20]||(e[20]=[t("div",{class:"flex flex-col items-center gap-3 opacity-40"},[t("span",{class:"material-symbols-outlined text-4xl"},"inventory_2"),t("span",{class:"text-slate-500 font-bold"},"Tidak ada modul yang ditemukan")],-1)])],8,ze)])):(r(!0),l(j,{key:2},R(q.value,s=>(r(),l("tr",{key:s.id,class:"hover:bg-slate-50 dark:hover:bg-slate-700/30 group transition-colors"},[t("td",Ae,[t("div",je,[t("div",Ee,[t("span",Re,m(s.icon),1),A(" "+m(s.name),1)]),v.value||u.value?.role==="Editor"?(r(),l("div",Ne,[t("button",{onClick:V(o=>X(s),["stop"]),class:"size-6 flex items-center justify-center rounded-md bg-blue-50 dark:bg-blue-900/20 text-blue-600 hover:bg-blue-600 hover:text-white transition-all"},[...e[21]||(e[21]=[t("span",{class:"material-symbols-outlined text-[14px]"},"edit",-1)])],8,Se),t("button",{onClick:V(o=>Y(s.id),["stop"]),class:"size-6 flex items-center justify-center rounded-md bg-rose-50 dark:bg-rose-900/20 text-rose-600 hover:bg-rose-600 hover:text-white transition-all"},[...e[22]||(e[22]=[t("span",{class:"material-symbols-outlined text-[14px]"},"delete",-1)])],8,Ue)])):x("",!0)])]),(r(!0),l(j,null,R(g.value,o=>(r(),l("td",{key:o.id,onClick:i=>G(s,o.id),class:"px-2 py-4 text-center cursor-pointer hover:bg-emerald-50/50 dark:hover:bg-emerald-900/10 transition-colors border-r border-slate-100 dark:border-slate-700"},[t("div",$e,[(r(!0),l(j,null,R(Z(s.permissions[o.id]),(i,S)=>(r(),l(j,{key:S},[i.isActive?(r(),l("span",De,m(i.char),1)):(r(),l("div",Ie))],64))),128))])],8,Ve))),128))]))),128))])])])]),k.value?(r(),l("div",Be,[t("div",Te,[t("div",qe,[t("h4",Pe,m(C.value?"Edit Role":"Tambah Role Baru"),1),t("button",{onClick:e[3]||(e[3]=s=>(k.value=!1,C.value=null)),class:"text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"},[...e[23]||(e[23]=[t("span",{class:"material-symbols-outlined"},"close",-1)])])]),t("div",Fe,[t("div",Le,[e[24]||(e[24]=t("label",{class:"text-xs font-bold text-slate-500 uppercase"},"Nama Role",-1)),E(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>f.value.role_name=s),type:"text",placeholder:"e.g. Project Manager",class:"w-full bg-slate-50 dark:bg-[#1c1c1c] border border-slate-200 dark:border-gray-800 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-emerald-500 outline-none"},null,512),[[U,f.value.role_name]])]),t("div",He,[e[25]||(e[25]=t("label",{class:"text-xs font-bold text-slate-500 uppercase"},"Kode Role (Singkatan)",-1)),E(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>f.value.role_code=s),type:"text",placeholder:"e.g. PM",class:"w-full bg-slate-50 dark:bg-[#1c1c1c] border border-slate-200 dark:border-gray-800 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-emerald-500 outline-none uppercase"},null,512),[[U,f.value.role_code]])])]),t("div",Ge,[t("button",{onClick:e[6]||(e[6]=s=>k.value=!1),class:"px-4 py-2 text-sm font-bold text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-white transition-colors"},"Batal"),t("button",{onClick:O,disabled:n.value,class:"px-6 py-2 text-sm font-bold text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 transition-all disabled:opacity-50"},[n.value?(r(),l("span",Oe)):x("",!0),e[26]||(e[26]=A(" Simpan Role ",-1))],8,Ke)])])])):x("",!0),_.value?(r(),l("div",Qe,[t("div",Je,[t("div",We,[t("h4",Xe,m(M.value?"Edit Modul":"Tambah Modul/Entitas"),1),t("button",{onClick:e[7]||(e[7]=s=>(_.value=!1,M.value=null)),class:"text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"},[...e[27]||(e[27]=[t("span",{class:"material-symbols-outlined"},"close",-1)])])]),t("div",Ye,[t("div",Ze,[e[28]||(e[28]=t("label",{class:"text-xs font-bold text-slate-500 uppercase"},"Nama Modul",-1)),E(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>w.value.name=s),type:"text",placeholder:"e.g. Inventaris Barang",class:"w-full bg-slate-50 dark:bg-[#1c1c1c] border border-slate-200 dark:border-gray-800 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-emerald-500 outline-none"},null,512),[[U,w.value.name]])])]),t("div",et,[t("button",{onClick:e[9]||(e[9]=s=>_.value=!1),class:"px-4 py-2 text-sm font-bold text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-white transition-colors"},"Batal"),t("button",{onClick:W,disabled:n.value,class:"px-6 py-2 text-sm font-bold text-white bg-emerald-600 rounded-lg hover:bg-emerald-700 transition-all disabled:opacity-50"},[n.value?(r(),l("span",at)):x("",!0),e[29]||(e[29]=A(" Simpan Modul ",-1))],8,tt)])])])):x("",!0),N.value?(r(),l("div",st,[t("div",lt,[t("div",rt,[t("h4",ot,"Update Izin: "+m(y.value.roleName),1),t("p",nt,"Modul: "+m(y.value.moduleName),1)]),t("div",dt,[(r(),l(j,null,R({can_create:"Create (C)",can_read:"Read (R)",can_update:"Update (U)",can_delete:"Delete (D)",can_verify:"Verify (V)"},(s,o)=>t("label",{key:o,class:"flex items-center justify-between p-3 rounded-xl border border-slate-100 dark:border-gray-800 bg-slate-50 dark:bg-[#1c1c1c] cursor-pointer hover:border-emerald-500/50 transition-all"},[t("span",it,m(s),1),E(t("input",{type:"checkbox","onUpdate:modelValue":i=>y.value[o]=i,class:"size-4 accent-emerald-600 cursor-pointer"},null,8,ct),[[re,y.value[o]]])])),64))]),t("div",ut,[t("button",{onClick:e[10]||(e[10]=s=>N.value=!1),class:"px-4 py-2 text-sm font-bold text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-white transition-colors"},"Batal"),t("button",{onClick:K,disabled:n.value,class:"px-6 py-2 text-sm font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-all disabled:opacity-50 shadow-lg shadow-blue-500/20"},[n.value?(r(),l("span",bt)):x("",!0),e[30]||(e[30]=A(" Update Akses ",-1))],8,pt)])])])):x("",!0)]))}},vt=te(mt,[["__scopeId","data-v-62101c81"]]);export{vt as default};
