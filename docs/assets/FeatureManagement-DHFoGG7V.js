import{_ as De,u as Ae,o as Ce,b as f,w as Pe,c as n,e,g as b,j as h,y,q as g,f as x,F as D,p as A,z as K,m as M,A as pe,l as o,k as m,I as Ue,B as qe,r as p,C as te,D as J,E as i}from"./index-DqWAqGTu.js";const Fe={class:"max-w-[1600px] mx-auto space-y-6"},Ie={class:"flex flex-col md:flex-row md:items-center justify-between gap-4 bg-white dark:bg-[#141414] p-6 rounded-2xl border border-slate-200 dark:border-gray-800 shadow-sm"},Re={class:"flex items-center gap-4"},Ee={class:"relative w-64 md:w-80"},Me={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},Te={class:"flex justify-between items-start mb-2"},$e={class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider"},Le={class:"text-3xl font-black text-slate-800 dark:text-white"},Be={class:"bg-white dark:bg-[#141414] border border-slate-200 dark:border-gray-800 rounded-2xl shadow-sm overflow-hidden"},Ve={class:"overflow-x-auto"},Ke={class:"w-full text-left border-collapse"},ze={class:"divide-y divide-slate-100 dark:divide-gray-800"},Oe={key:0,class:"animate-pulse"},Ne={key:1,class:"hover:bg-slate-50 dark:hover:bg-[#1a1a1a]/30 transition-colors"},He=["onClick"],Ge={class:"px-6 py-5"},Je={class:"flex items-center gap-4"},Qe={class:"text-sm font-bold text-slate-800 dark:text-white group-hover:text-accent-emerald transition-colors leading-tight"},Xe={class:"text-[10px] text-slate-500 dark:text-slate-500 font-bold mt-1 uppercase tracking-wider"},Ye={class:"px-6 py-5"},We={class:"flex items-center gap-3"},Ze=["src"],et={class:"flex flex-col"},tt={class:"text-xs font-bold text-slate-700 dark:text-slate-200"},at={class:"text-[10px] text-slate-500 dark:text-slate-500 font-medium"},st={class:"px-6 py-5 text-center"},rt={class:"px-6 py-5 text-center relative status-dropdown-container"},lt={class:"flex items-center justify-center gap-2"},ot=["onClick"],nt={key:0,class:"absolute right-6 top-12 z-50 w-56 bg-white dark:bg-[#1e1e1e] rounded-lg shadow-xl border border-slate-200 dark:border-gray-700 py-1 animate-in fade-in zoom-in duration-200 text-left"},it=["onClick"],dt={class:"px-6 py-5 text-right"},ut=["onClick"],ct={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},pt={class:"bg-white dark:bg-[#111111] border border-slate-200 dark:border-gray-800 w-full md:w-[70%] max-h-[90vh] rounded-3xl overflow-hidden flex flex-col z-10 shadow-2xl transition-all"},xt={class:"p-6 border-b border-slate-100 dark:border-gray-800 flex items-center justify-between bg-slate-50 dark:bg-[#1a1a1a]"},bt={class:"flex-1 overflow-y-auto custom-scrollbar p-8 bg-white dark:bg-[#111111]"},gt={class:"space-y-6"},mt={class:"space-y-2"},kt={class:"grid grid-cols-2 gap-4"},ft={class:"space-y-2"},vt=["value"],ht={class:"space-y-2"},wt=["value"],_t={class:"grid grid-cols-2 gap-4"},yt={class:"space-y-2"},jt={key:0,class:"space-y-2"},St={class:"grid grid-cols-2 gap-4"},Dt={class:"space-y-2"},At={class:"space-y-2"},Ct={class:"space-y-6"},Pt={class:"grid grid-cols-2 gap-4"},Ut={class:"space-y-2"},qt={class:"space-y-2"},Ft={class:"space-y-2"},It={class:"grid grid-cols-2 gap-4"},Rt={class:"space-y-2"},Et={class:"grid grid-cols-2 gap-2"},Mt={class:"space-y-2"},Tt=["value"],$t={class:"space-y-2"},Lt={class:"flex flex-col gap-2"},Bt={class:"flex gap-2"},Vt={class:"material-symbols-outlined text-sm"},Kt={class:"text-[10px] font-bold truncate max-w-[80px]"},zt={class:"p-6 border-t border-slate-100 dark:border-gray-800 bg-slate-50 dark:bg-[#1a1a1a] flex items-center justify-end gap-4 shrink-0"},Ot=["disabled"],Nt={key:0,class:"material-symbols-outlined animate-spin text-sm"},Ht={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-0 md:p-4"},Gt={class:"bg-white dark:bg-[#111111] border border-slate-200 dark:border-gray-800 w-full md:max-w-[100vw] h-full md:h-[100vh] md:rounded-none overflow-hidden z-10 flex flex-col shadow-2xl transition-all"},Jt={class:"h-20 bg-slate-50 dark:bg-[#1a1a1a]/50 border-b border-slate-200 dark:border-gray-800 flex items-center justify-between px-8 shrink-0"},Qt={class:"flex flex-col"},Xt={class:"flex items-center gap-3"},Yt={class:"text-xl font-black text-slate-800 dark:text-white leading-none"},Wt={class:"flex items-center gap-3"},Zt={class:"flex-1 overflow-y-auto custom-scrollbar p-8 bg-slate-50/30 dark:bg-transparent"},ea={class:"max-w-[1600px] mx-auto"},ta={class:"grid grid-cols-12 gap-6 mb-8"},aa={class:"col-span-8 space-y-6"},sa={class:"bg-white dark:bg-[#111111] border border-slate-200 dark:border-gray-800 rounded-xl p-6 shadow-sm"},ra={class:"grid grid-cols-3 gap-y-6 gap-x-4"},la={class:"flex items-center gap-2"},oa=["src"],na={class:"text-sm text-slate-700 dark:text-white/90 font-bold"},ia={class:"text-sm text-slate-700 dark:text-white/90 font-bold"},da={class:"text-sm text-slate-700 dark:text-white/90 font-bold"},ua={class:"text-sm text-slate-700 dark:text-white/90 font-bold"},ca={class:"text-sm text-slate-700 dark:text-white/90 font-bold"},pa={class:"text-sm text-slate-700 dark:text-white/90 font-bold"},xa={class:"bg-white dark:bg-[#111111] border border-slate-200 dark:border-gray-800 rounded-xl p-6 shadow-sm"},ba={class:"space-y-6"},ga={class:"text-slate-800 dark:text-white font-black text-lg"},ma={class:"grid grid-cols-2 gap-4"},ka={class:"inline-flex items-center gap-2 px-2.5 py-1 bg-emerald-900/10 dark:bg-emerald-500/10 text-emerald-900 dark:text-emerald-400 rounded text-xs font-bold border border-emerald-900/20 dark:border-emerald-500/20"},fa={class:"text-sm text-slate-600 dark:text-white/60 leading-relaxed font-medium"},va={class:"bg-white dark:bg-[#111111] border border-slate-200 dark:border-gray-800 rounded-xl p-6 shadow-sm"},ha={class:"space-y-6"},wa={class:"bg-slate-50 dark:bg-black/20 p-4 rounded-lg border border-slate-100 dark:border-white/5"},_a={class:"text-sm text-slate-600 dark:text-white/70 leading-relaxed font-medium"},ya={class:"bg-slate-50 dark:bg-black/20 p-4 rounded-lg border border-slate-100 dark:border-white/5"},ja={class:"text-sm text-slate-600 dark:text-white/70 leading-relaxed font-medium"},Sa={class:"grid grid-cols-2 gap-4"},Da={class:"p-4 rounded-lg bg-accent-emerald/5 border border-accent-emerald/10"},Aa={class:"text-sm text-slate-700 dark:text-white/80 font-medium"},Ca={class:"col-span-4 space-y-6"},Pa={class:"flex items-center gap-3"},Ua={class:"bg-white dark:bg-[#111111] border border-slate-200 dark:border-gray-800 rounded-xl p-6 shadow-sm"},qa={class:"space-y-6 relative before:absolute before:left-[11px] before:top-2 before:bottom-2 before:w-px before:bg-slate-100 dark:before:bg-white/10"},Fa={class:"relative pl-8"},Ia={class:"text-[10px] text-slate-400 dark:text-white/40 font-bold"},Ra={key:0,class:"relative pl-8"},Ea={class:"text-xs font-black text-blue-500 dark:text-blue-400"},Ma={class:"text-[10px] text-slate-400 dark:text-white/40 font-bold"},Ta={key:1,class:"relative pl-8"},$a={key:0,class:"bg-white dark:bg-[#111111] border border-red-500/20 rounded-xl p-6 shadow-sm"},La={class:"text-xs text-slate-600 dark:text-white/60 leading-relaxed bg-red-50 dark:bg-red-500/5 p-3 rounded-lg border border-red-100 dark:border-red-500/10 italic font-medium"},Ba={key:1,class:"bg-white dark:bg-[#111111] border border-slate-200 dark:border-gray-800 rounded-xl p-6 shadow-sm"},Va={class:"grid grid-cols-1 gap-2"},Ka=["onClick"],za={key:0,class:"material-symbols-outlined text-sm"},Oa={class:"col-span-12 space-y-6"},Na={class:"bg-white dark:bg-[#111111] border border-slate-200 dark:border-gray-800 rounded-xl p-6 shadow-sm"},Ha={class:"grid grid-cols-4 gap-4"},Ga=["href"],Ja={class:"aspect-video rounded-lg overflow-hidden border border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-white/5 flex items-center justify-center group-hover:border-accent-emerald/50 transition-all"},Qa={class:"material-symbols-outlined text-slate-300 dark:text-white/20 text-3xl"},Xa={class:"mt-2 text-[10px] text-slate-400 dark:text-white/40 font-bold truncate"},Ya={key:0,class:"text-[8px] text-slate-500 dark:text-white/20 truncate"},Wa={key:0,class:"col-span-4 text-center py-8 border border-dashed border-slate-200 dark:border-white/10 rounded-xl"},Za={class:"bg-white dark:bg-[#111111] border border-slate-200 dark:border-gray-800 rounded-xl p-6 flex flex-col h-[750px] shadow-sm overflow-hidden"},es={class:"text-sm font-black text-slate-800 dark:text-white flex items-center gap-2 mb-6 pb-4 border-b border-slate-100 dark:border-gray-800 shrink-0"},ts={class:"flex-1 overflow-y-auto custom-scrollbar pr-2 space-y-6 mb-6"},as=["src"],ss={class:"flex items-center gap-2 mb-1 px-1"},rs={class:"text-[10px] font-bold text-slate-400 dark:text-white/40"},ls={class:"text-[8px] bg-slate-100 dark:bg-white/5 text-slate-500 dark:text-white/40 px-1.5 py-0.5 rounded uppercase tracking-wider font-bold"},os={key:0,class:"mb-2 -mx-1 -mt-1 overflow-hidden rounded-xl border border-black/5 dark:border-white/5 bg-black/5 dark:bg-black/20"},ns=["href"],is=["src"],ds={key:1,class:"p-3 flex items-center gap-3"},us={class:"leading-relaxed whitespace-pre-wrap"},cs={key:0,class:"h-full flex flex-col items-center justify-center opacity-40"},ps={class:"mt-auto shrink-0"},xs={key:0,class:"mb-3 p-2 bg-accent-emerald/10 border border-accent-emerald/20 rounded-xl flex items-center justify-between"},bs={class:"flex items-center gap-2"},gs={class:"flex flex-col"},ms={class:"text-[10px] font-bold text-slate-700 dark:text-white truncate max-w-[200px]"},ks={class:"text-[9px] text-slate-500 dark:text-white/40 font-bold"},fs={class:"relative flex items-end gap-2"},vs={class:"flex-1 bg-slate-50 dark:bg-black/40 border border-slate-200 dark:border-white/10 rounded-2xl focus-within:border-accent-emerald/50 transition-all p-2"},hs=["onKeyup"],ws={class:"flex items-center justify-between px-2 pt-1 mt-1 border-t border-slate-100 dark:border-white/5"},_s={class:"flex items-center gap-1"},ys=["disabled"],js={key:0,class:"material-symbols-outlined animate-spin text-sm"},Ss={key:1,class:"material-symbols-outlined text-sm"},Ds={class:"p-6 border-t border-slate-200 dark:border-gray-800 bg-slate-50 dark:bg-[#1a1a1a]/50 flex items-center justify-between"},As={class:"flex items-center gap-2"},Cs={class:"text-[10px] text-slate-400 dark:text-white/30 italic font-bold"},Ps={key:2,class:"fixed inset-0 z-[60] flex items-center justify-center p-4"},Us={class:"bg-white dark:bg-[#141414] border border-slate-200 dark:border-gray-800 w-full max-w-md rounded-2xl overflow-hidden z-10 shadow-2xl transition-all"},qs={class:"p-6 space-y-4"},Fs={class:"p-6 border-t border-slate-100 dark:border-gray-800 bg-slate-50 dark:bg-[#1a1a1a]/50 flex justify-end gap-3"},Is=["disabled"],Rs={__name:"FeatureManagement",setup(Es){const u=Ae(),ae=qe(),Q=p(!0),j=p([]),T=p({total:0,reviewing:0,approved:0,rejected:0}),C=p(!1),P=p(!1),q=p(!1),$=p(""),S=p(!1),l=p(null),L=p(null),xe=s=>{L.value=L.value===s?null:s},U=p([]),B=p([]),X=p([]),F=p(null),se=p(null),d=p({project_id:"",component_id:"",reporter_id:"",judul_request:"",kategori_dev:"Fitur Baru",status_perwakilan:"Inisiatif Sendiri",kode_pesantren:"",unit_yayasan:"",kategori_modul:"",deskripsi_masukan:"",masalah:"",usulan:"",dampak:"",urgensi:"Medium",attachment_wa:"",attachment_lain:""}),z=p(""),Y={Baru:1,"Sedang Ditinjau":2,"Sedang Dipertimbangkan":3,"Sedang Dikembangkan":4,Selesai:5,Ditolak:6},be=Object.keys(Y),re=te(()=>{let s=[...j.value];if(z.value){const t=z.value.toLowerCase();s=s.filter(a=>a.judul_request?.toLowerCase().includes(t)||a.unit_yayasan?.toLowerCase().includes(t)||a.reporter?.full_name?.toLowerCase().includes(t))}return s.sort((t,a)=>{const r=Y[t.status_lifecycle]||99,c=Y[a.status_lifecycle]||99;return r!==c?r-c:new Date(a.created_at)-new Date(t.created_at)})}),le=te(()=>{const s=[];return l.value&&(l.value.attachment_wa&&s.push({name:"Link Lampiran (Utama)",url:l.value.attachment_wa,type:"link"}),l.value.attachment_lain&&s.push({name:"Lampiran Tambahan",url:l.value.attachment_lain,type:"file"}),V.value.forEach((t,a)=>{t.attachment_url&&s.push({name:`Lampiran Diskusi #${a+1}`,url:t.attachment_url,type:"file",user:t.user?.full_name})})),s}),V=p([]),I=p(""),O=p(!1),w=p(null),R=p(null),ge=()=>{R.value?.click()},me=s=>{const t=s.target.files[0];t&&(w.value=t)},ke=()=>{w.value=null,R.value&&(R.value.value="")},oe=async s=>{try{const{data:t}=await f.get(`/discussion_forum?parent_id=eq.${s}&parent_type=eq.FEATURE&select=*,user:profiles(full_name,avatar_url,role)&order=created_at.asc`);V.value=t||[]}catch(t){console.error("Error fetching comments:",t)}},ne=async s=>{try{const t=s.name.split(".").pop(),r=`forum/${`${Math.random()}.${t}`}`,{error:c}=await J.storage.from("forum-attachments").upload(r,s);if(c)throw c;const{data:k}=J.storage.from("forum-attachments").getPublicUrl(r);return k.publicUrl}catch(t){return console.error("Error uploading file:",t),null}},ie=async()=>{if(!(!I.value.trim()&&!w.value||!l.value||!u.user)){O.value=!0;try{let s=null;w.value&&(s=await ne(w.value)),await f.post("/discussion_forum",{parent_id:l.value.id,parent_type:"FEATURE",user_id:u.user.id,comment_text:I.value.trim(),attachment_url:s,created_at:new Date().toISOString()}),I.value="",w.value=null,R.value&&(R.value.value=""),await oe(l.value.id)}catch(s){console.error("Error sending comment:",s),alert("Gagal mengirim komentar: "+s.message)}finally{O.value=!1}}},N=async s=>{l.value=s,P.value=!0,await oe(s.id)},de=async()=>{try{const s=(u.user?.role||"Viewer").toString(),t=["Super Admin","Admin"].includes(s),a=u.user?.id,r=d.value.project_id||u.user?.project_id||1;let c="/profiles?select=id,full_name,avatar_url,project_id,email";r&&(c+=`&project_id=eq.${r}`);const k=await f.get(c),_=Array.isArray(k.data)?k.data:[];a&&!_.find(v=>v.id===a)&&_.unshift({id:a,full_name:u.user?.full_name||u.user?.email||"Saya",avatar_url:u.user?.avatar_url,email:u.user?.email}),X.value=_,!d.value.reporter_id&&a&&(d.value.reporter_id=a)}catch(s){console.error("Error fetching profiles:",s),u.user?.id&&(X.value=[{id:u.user.id,full_name:u.user.email||"Saya"}],d.value.reporter_id=u.user.id)}},fe=async()=>{try{const s=["Super Admin","Admin"].includes(u.user?.role),t=u.user?.project_id||1;let a="/projects?select=id,name",r="/app_components?select=id,name";a+=`&id=eq.${t}`,r+=`&project_id=eq.${t}`;const[c,k]=await Promise.all([f.get(a),f.get(r)]);if(console.log("Initial data fetched:",{projects:c.data,components:k.data}),U.value=c.data||[],B.value=k.data||[],U.value.length>0){const _=s?U.value[0]:U.value.find(v=>v.id===t);d.value.project_id=_?.id||U.value[0].id}B.value.length>0&&(d.value.component_id=B.value[0].id)}catch(s){console.error("Error fetching initial data:",s)}},E=async()=>{Q.value=!0;try{const s=["Super Admin","Admin"].includes(u.user?.role),t=u.user?.project_id||1;let a="/feature_requests?select=*,reporter:profiles(full_name,avatar_url),component:app_components(name),project:projects(name)&order=created_at.desc";a+=`&project_id=eq.${t}`;const{data:r}=await f.get(a);console.log("Requests fetched via axios:",r),j.value=r||[],T.value={total:j.value.length,reviewing:j.value.filter(c=>c.status_lifecycle==="Sedang Ditinjau").length,approved:j.value.filter(c=>["Sedang Dikembangkan","Selesai"].includes(c.status_lifecycle)).length,rejected:j.value.filter(c=>c.status_lifecycle==="Ditolak").length}}catch(s){console.error("Error fetching requests:",s)}finally{Q.value=!1}},ve=async()=>{if(S.value)return;if(!u.user){alert("Anda harus login untuk mengirim request.");return}if(!["Super Admin","Admin","Editor"].includes(u.user.role)){alert("Akses Ditolak: Hanya Editor dan Super Admin yang dapat menambahkan fitur baru.");return}S.value=!0;try{let t=null;F.value&&(t=await ne(F.value));const a=d.value,r={project_id:Number(u.user?.project_id||a.project_id||1),reporter_id:a.reporter_id||u.user.id,component_id:a.component_id||null,status_perwakilan:a.status_perwakilan,kode_pesantren:a.status_perwakilan==="Inisiatif Sendiri"?null:a.kode_pesantren||null,unit_yayasan:a.unit_yayasan||null,kategori_modul:a.kategori_modul||null,judul_request:a.judul_request,kategori_dev:a.kategori_dev,deskripsi_masukan:a.deskripsi_masukan||null,masalah:a.masalah||null,usulan:a.usulan||null,dampak:a.dampak||null,urgensi:a.urgensi||"Medium",attachment_wa:a.attachment_wa||null,attachment_lain:t||a.attachment_lain||null,status_lifecycle:"Baru"};console.log("Sending feature request explicit payload via axios:",r),console.log("Attempting insert via Supabase SDK (Primary)...");const c=J.from("feature_requests").insert(r).select().single(),k=new Promise((_,v)=>setTimeout(()=>v(new Error("Force Timeout 7s: Supabase SDK request hung")),7e3));try{const{data:_,error:v}=await Promise.race([c,k]);if(v)throw v;console.log("Supabase SDK Insert success:",_),S.value=!1,C.value=!1,W(),E(),alert("Request fitur berhasil dikirim!")}catch(_){console.error("Supabase SDK insert failed, trying RPC fallback...",_);try{console.log("Attempting insert via RPC submit_feature_request...");const v={p_project_id:r.project_id,p_component_id:r.component_id,p_reporter_id:r.reporter_id,p_judul_request:r.judul_request,p_kategori_dev:r.kategori_dev,p_deskripsi_masukan:r.deskripsi_masukan,p_urgensi:r.urgensi,p_status_perwakilan:r.status_perwakilan,p_kode_pesantren:r.kode_pesantren,p_unit_yayasan:r.unit_yayasan,p_kategori_modul:r.kategori_modul,p_masalah:r.masalah,p_usulan:r.usulan,p_dampak:r.dampak,p_attachment_wa:r.attachment_wa,p_attachment_lain:r.attachment_lain},{data:ee,error:G}=await J.rpc("submit_feature_request",v);if(G)throw G;console.log("RPC Insert success:",ee),S.value=!1,C.value=!1,W(),E(),alert("Request fitur berhasil dikirim (via RPC Fallback)!");return}catch(v){console.error("RPC fallback failed, trying Axios fallback...",v);const ee={timeout:1e4,headers:{"Content-Type":"application/json",Prefer:"return=representation"}},{data:G}=await f.post("/feature_requests",r,ee);console.log("Axios Fallback success:",G),S.value=!1,C.value=!1,W(),E(),alert("Request fitur berhasil dikirim (via Axios Fallback)!")}}}catch(t){console.error("Final catch error saving request:",t),S.value=!1;let a="Terjadi kesalahan pada server database";t.message?.includes("Timeout")||t.code==="ECONNABORTED"?a='Request timed out. Mohon jalankan script SQL "fix_feature_rpc_v2.sql" di Supabase Dashboard.':t.message?a=t.message:t.details&&(a=t.details),alert("Gagal menyimpan request: "+a)}finally{S.value=!1}},H=async(s,t)=>{if(!["Super Admin","Admin","Editor"].includes(u.user?.role)){alert("Anda tidak memiliki izin untuk mengubah status.");return}if(t==="Ditolak"&&!q.value){q.value=!0,L.value=null;return}try{const a={status_lifecycle:t,updated_at:new Date().toISOString()};t==="Ditolak"&&(a.alasan_penolakan=$.value);const r={timeout:1e4};if(await f.patch(`/feature_requests?id=eq.${s}`,a,r),t==="Ditolak"&&(q.value=!1,$.value=""),["Sedang Dipertimbangkan","Sedang Dikembangkan"].includes(t)&&await he(s),t==="Selesai"&&await we(s),await E(),l.value?.id===s){const c=j.value.find(k=>k.id===s);c&&(l.value=c)}L.value=null,alert(`Status berhasil diperbarui ke ${t}`)}catch(a){console.error("Error updating status:",a);const r=a.code==="ECONNABORTED"?"Request timed out (Check RLS policies)":a.response?.data?.message||a.message;alert("Gagal memperbarui status: "+r)}},he=async s=>{try{const t=j.value.find(k=>k.id===s);if(!t)return;const{data:a}=await f.get(`/feature_backlog?discussion_reference=eq.${s}&select=id`);if(a&&a.length>0)return;const r={project_id:t.project_id,feature_name:t.judul_request,functionality:t.deskripsi_masukan,urgency:t.urgensi,discussion_reference:s.toString(),stage:"Backlog",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},c={timeout:1e4};await f.post("/feature_backlog",r,c)}catch(t){console.error("Error promoting to backlog:",t)}},we=async s=>{try{const t={timeout:1e4};await f.patch(`/feature_backlog?discussion_reference=eq.${s}`,{stage:"Launched",updated_at:new Date().toISOString()},t)}catch(t){console.error("Error syncing backlog finish:",t)}},_e=async s=>{if(!["Super Admin","Admin","Editor"].includes(u.user?.role)){alert("Anda tidak memiliki izin untuk menghapus data.");return}if(confirm("Apakah Anda yakin ingin menghapus pengajuan ini?"))try{const t={timeout:1e4};await f.delete(`/feature_requests?id=eq.${s}`,t),await E(),P.value=!1,alert("Pengajuan berhasil dihapus")}catch(t){console.error("Error deleting request:",t);const a=t.code==="ECONNABORTED"?"Request timed out (Check RLS policies)":t.response?.data?.message||t.message;alert("Gagal menghapus: "+a)}},W=()=>{d.value={project_id:U.value[0]?.id||"",component_id:B.value[0]?.id||"",reporter_id:u.user?.id||"",judul_request:"",kategori_dev:"Fitur Baru",status_perwakilan:"Inisiatif Sendiri",kode_pesantren:"",unit_yayasan:"",kategori_modul:"",deskripsi_masukan:"",masalah:"",usulan:"",dampak:"",urgensi:"Medium",attachment_wa:"",attachment_lain:""}},Z=s=>{switch(s){case"Baru":return"bg-gray-600/10 text-gray-600 dark:bg-gray-400/10 dark:text-gray-400 border-gray-600/20 dark:border-gray-400/20";case"Sedang Ditinjau":return"bg-blue-500/10 text-blue-400 border-blue-400/20";case"Sedang Dipertimbangkan":return"bg-amber-500/10 text-amber-400 border-amber-400/20";case"Sedang Dikembangkan":return"bg-emerald-500/10 text-emerald-400 border-emerald-400/20";case"Selesai":return"bg-purple-500/10 text-purple-400 border-purple-400/20";case"Ditolak":return"bg-red-500/10 text-red-400 border-red-400/20";default:return"bg-white/5 text-white/40 border-white/10"}},ue=s=>{switch(s?.toLowerCase()){case"low":return"bg-yellow-50 text-yellow-600 dark:bg-yellow-900/10 dark:text-yellow-500 border-yellow-200/50";case"medium":return"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400 border-orange-200/50";case"high":return"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400 border-red-200/50";case"critical":return"bg-red-600 text-white dark:bg-red-700 dark:text-red-50 border-red-500";default:return"bg-gray-50 text-gray-600 border-gray-200/50"}},ce=s=>{switch(s){case"Critical":return"text-white";case"High":return"text-red-700 dark:text-red-400";case"Medium":return"text-orange-700 dark:text-orange-400";case"Low":return"text-yellow-600 dark:text-yellow-500";default:return"text-white/40"}},ye=s=>{switch(s){case"Critical":return"bg-red-600 dark:bg-red-700";case"High":return"bg-red-100 dark:bg-red-900/20";case"Medium":return"bg-orange-100 dark:bg-orange-900/20";case"Low":return"bg-yellow-50 dark:bg-yellow-900/10";default:return"bg-white/5"}},je=s=>{switch(s){case"Critical":return"border-red-500";case"High":return"border-red-200/50 dark:border-red-800/50";case"Medium":return"border-orange-200/50 dark:border-orange-800/50";case"Low":return"border-yellow-200/50 dark:border-yellow-800/50";default:return"border-white/5"}},Se=te(()=>({"Total Pengajuan":T.value.total,"Dalam Peninjauan":T.value.reviewing,"Disetujui/Dev":T.value.approved,"Ditolak/Arsip":T.value.rejected}));return Ce(async()=>{if(await fe(),await de(),await E(),ae.query.detailId){const s=parseInt(ae.query.detailId),t=j.value.find(a=>a.id===s);if(t)N(t);else try{const{data:a}=await f.get(`/feature_requests?id=eq.${s}&select=*,reporter:profiles(full_name,avatar_url),component:app_components(name),project:projects(name)`);a&&a.length>0&&N(a[0])}catch(a){console.error("Error fetching specific feature request details:",a)}}}),Pe(()=>d.value.project_id,()=>{de()}),(s,t)=>(i(),n("div",Fe,[e("div",Ie,[t[36]||(t[36]=e("div",{class:"flex flex-col"},[e("h2",{class:"text-2xl font-black text-slate-800 dark:text-white leading-tight"},"Manajemen Penambahan Fitur"),e("p",{class:"text-xs text-slate-500 dark:text-slate-400 mt-1 font-medium"},"Pesantren Smart Digital • Roadmap System & Feature Requests")],-1)),e("div",Re,[e("div",Ee,[t[34]||(t[34]=e("span",{class:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-slate-500 text-lg"},"search",-1)),b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>z.value=a),class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl py-2 pl-10 pr-4 text-sm text-slate-800 dark:text-white placeholder-slate-400 dark:placeholder-slate-500 focus:ring-2 focus:ring-accent-emerald focus:border-transparent transition-all outline-none",placeholder:"Cari judul, unit, atau pelapor...",type:"text"},null,512),[[h,z.value]])]),["Super Admin","Admin","Editor"].includes(y(u).user?.role)?(i(),n("button",{key:0,onClick:t[1]||(t[1]=a=>C.value=!0),class:"bg-emerald-600 hover:bg-emerald-500 dark:bg-emerald-400 dark:hover:bg-emerald-300 text-white dark:text-[#032A28] px-5 py-2.5 rounded-xl text-sm font-bold transition-all flex items-center gap-2 shadow-lg shadow-emerald-600/20 active:scale-95"},[...t[35]||(t[35]=[e("span",{class:"material-symbols-outlined text-lg"},"add_circle",-1),g(" Ajukan Fitur ",-1)])])):x("",!0)])]),e("div",Me,[(i(!0),n(D,null,A(Se.value,(a,r)=>(i(),n("div",{key:r,class:"bg-white dark:bg-[#111111] border border-slate-200 dark:border-gray-800 rounded-2xl p-5 shadow-sm group hover:border-accent-emerald/50 transition-all"},[e("div",Te,[e("span",$e,o(r),1),t[37]||(t[37]=e("div",{class:"p-2 bg-slate-50 dark:bg-[#1a1a1a] rounded-lg group-hover:bg-accent-emerald/10 transition-colors"},[e("span",{class:"material-symbols-outlined text-slate-400 group-hover:text-accent-emerald transition-colors text-xl"},"analytics")],-1))]),e("h4",Le,o(a),1)]))),128))]),e("div",Be,[e("div",Ve,[e("table",Ke,[t[42]||(t[42]=e("thead",null,[e("tr",{class:"bg-slate-50 dark:bg-[#1a1a1a] border-b border-slate-200 dark:border-gray-800"},[e("th",{class:"px-6 py-4 text-[10px] font-black text-slate-500 dark:text-white uppercase tracking-widest"},"Fitur & Modul"),e("th",{class:"px-6 py-4 text-[10px] font-black text-slate-500 dark:text-white uppercase tracking-widest"},"Pelapor"),e("th",{class:"px-6 py-4 text-[10px] font-black text-slate-500 dark:text-white uppercase tracking-widest text-center"},"Urgensi"),e("th",{class:"px-6 py-4 text-[10px] font-black text-slate-500 dark:text-white uppercase tracking-widest text-center"},"Status"),e("th",{class:"px-6 py-4 text-[10px] font-black text-slate-500 dark:text-white uppercase tracking-widest text-right"},"Aksi")])],-1)),e("tbody",ze,[Q.value?(i(),n("tr",Oe,[...t[38]||(t[38]=[e("td",{colspan:"5",class:"px-6 py-12 text-center text-slate-400 dark:text-slate-500 italic text-sm"},"Memuat data pengajuan...",-1)])])):re.value.length===0?(i(),n("tr",Ne,[...t[39]||(t[39]=[e("td",{colspan:"5",class:"px-6 py-16 text-center"},[e("div",{class:"flex flex-col items-center gap-3"},[e("div",{class:"p-4 bg-slate-50 dark:bg-[#1a1a1a] rounded-full"},[e("span",{class:"material-symbols-outlined text-5xl text-slate-200 dark:text-slate-700"},"inventory_2")]),e("p",{class:"text-slate-400 dark:text-slate-500 text-sm font-medium"},"Tidak ada data pengajuan fitur ditemukan")])],-1)])])):x("",!0),(i(!0),n(D,null,A(re.value,a=>(i(),n("tr",{key:a.id,onClick:r=>N(a),class:"group hover:bg-slate-50 dark:hover:bg-[#1a1a1a]/40 transition-all cursor-pointer"},[e("td",Ge,[e("div",Je,[e("div",{class:m(["w-1.5 h-8 rounded-full",ue(a.urgensi)])},null,2),e("div",null,[e("div",Qe,o(a.judul_request),1),e("div",Xe,o(a.project?.name)+" • "+o(a.kategori_modul),1)])])]),e("td",Ye,[e("div",We,[e("img",{src:a.reporter?.avatar_url||"https://ui-avatars.com/api/?name="+a.reporter?.full_name,class:"w-9 h-9 rounded-full border-2 border-white dark:border-gray-800 shadow-sm",alt:"Avatar"},null,8,Ze),e("div",et,[e("span",tt,o(a.reporter?.full_name),1),e("span",at,o(a.unit_yayasan),1)])])]),e("td",st,[e("span",{class:m(["text-[10px] font-black px-2.5 py-1 rounded-lg uppercase tracking-tight border shadow-sm transition-all",ue(a.urgensi)])},o(a.urgensi),3)]),e("td",rt,[e("div",lt,[e("span",{class:m(["status-badge shadow-sm",Z(a.status_lifecycle)])},o(a.status_lifecycle),3),["Super Admin","Admin","Editor"].includes(y(u).user?.role)?(i(),n("button",{key:0,onClick:K(r=>xe(a.id),["stop"]),class:"p-1 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors"},[...t[40]||(t[40]=[e("span",{class:"material-symbols-outlined text-[16px]"},"expand_more",-1)])],8,ot)):x("",!0)]),L.value===a.id?(i(),n("div",nt,[(i(!0),n(D,null,A(y(be),r=>(i(),n("button",{key:r,onClick:K(c=>H(a.id,r),["stop"]),class:m(["w-full text-left px-4 py-2.5 text-xs font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800 flex items-center gap-2",{"bg-slate-50 dark:bg-slate-800":a.status_lifecycle===r}])},[e("span",{class:m([Z(r),"w-2 h-2 rounded-full block border shadow-sm"])},null,2),g(" "+o(r),1)],10,it))),128))])):x("",!0)]),e("td",dt,[e("button",{onClick:K(r=>N(a),["stop"]),class:"bg-slate-100 dark:bg-[#1a1a1a] text-slate-500 dark:text-slate-400 hover:bg-accent-emerald hover:text-[#032A28] p-2.5 rounded-xl transition-all"},[...t[41]||(t[41]=[e("span",{class:"material-symbols-outlined text-xl"},"edit_note",-1)])],8,ut)])],8,He))),128))])])])]),C.value?(i(),n("div",ct,[e("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:t[2]||(t[2]=a=>C.value=!1)}),e("div",pt,[e("div",xt,[t[44]||(t[44]=e("div",null,[e("h3",{class:"text-xl font-black text-slate-800 dark:text-white"},"Ajukan Fitur Baru"),e("p",{class:"text-[10px] text-slate-500 dark:text-slate-400 uppercase tracking-widest font-bold mt-1"},"Formulir Pengusulan Pengembangan")],-1)),e("button",{onClick:t[3]||(t[3]=a=>C.value=!1),class:"text-slate-400 hover:text-slate-600 dark:text-slate-500 dark:hover:text-white transition-colors p-2 hover:bg-slate-100 dark:hover:bg-white/5 rounded-full"},[...t[43]||(t[43]=[e("span",{class:"material-symbols-outlined"},"close",-1)])])]),e("div",bt,[e("form",{id:"addFeatureForm",onSubmit:K(ve,["prevent"]),class:"grid grid-cols-2 gap-8"},[e("div",gt,[t[53]||(t[53]=e("h4",{class:"text-xs font-bold text-accent-emerald uppercase tracking-widest border-b border-accent-emerald/20 pb-2 dark:text-white"},"Informasi Dasar",-1)),e("div",mt,[t[45]||(t[45]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Judul Request Fitur",-1)),b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>d.value.judul_request=a),type:"text",class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald focus:border-transparent transition-all outline-none",placeholder:"Contoh: Modul Absensi Face Recognition",required:""},null,512),[[h,d.value.judul_request]])]),e("div",kt,[e("div",ft,[t[46]||(t[46]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Proyek / Pesantren",-1)),b(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>d.value.project_id=a),class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none transition-all"},[(i(!0),n(D,null,A(U.value,a=>(i(),n("option",{key:a.id,value:a.id},o(a.name),9,vt))),128))],512),[[M,d.value.project_id]])]),e("div",ht,[t[47]||(t[47]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Komponen Utama",-1)),b(e("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>d.value.component_id=a),class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none transition-all"},[(i(!0),n(D,null,A(B.value,a=>(i(),n("option",{key:a.id,value:a.id},o(a.name),9,wt))),128))],512),[[M,d.value.component_id]])])]),e("div",_t,[e("div",yt,[t[49]||(t[49]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Status Perwakilan",-1)),b(e("select",{"onUpdate:modelValue":t[7]||(t[7]=a=>d.value.status_perwakilan=a),class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none transition-all"},[...t[48]||(t[48]=[e("option",{value:"Inisiatif Sendiri"},"Inisiatif Sendiri",-1),e("option",{value:"Mewakili Pesantren"},"Mewakili Pesantren",-1)])],512),[[M,d.value.status_perwakilan]])]),d.value.status_perwakilan==="Mewakili Pesantren"?(i(),n("div",jt,[t[50]||(t[50]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Kode Pesantren",-1)),b(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>d.value.kode_pesantren=a),type:"text",class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none transition-all",placeholder:"Masukkan Kode"},null,512),[[h,d.value.kode_pesantren]])])):x("",!0)]),e("div",St,[e("div",Dt,[t[51]||(t[51]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Unit / Yayasan",-1)),b(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>d.value.unit_yayasan=a),type:"text",class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none transition-all",placeholder:"Contoh: Unit Madrasah"},null,512),[[h,d.value.unit_yayasan]])]),e("div",At,[t[52]||(t[52]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Kategori Modul",-1)),b(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>d.value.kategori_modul=a),type:"text",class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none transition-all",placeholder:"Contoh: Akademik"},null,512),[[h,d.value.kategori_modul]])])])]),e("div",Ct,[t[63]||(t[63]=e("h4",{class:"text-xs font-bold text-accent-emerald uppercase tracking-widest border-b border-accent-emerald/20 pb-2 dark:text-white"},"Detail Teknis & Urgensi",-1)),e("div",Pt,[e("div",Ut,[t[55]||(t[55]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Tipe Pengembangan",-1)),b(e("select",{"onUpdate:modelValue":t[11]||(t[11]=a=>d.value.kategori_dev=a),class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none transition-all"},[...t[54]||(t[54]=[pe('<option value="Fitur Baru" data-v-73ab937e>Fitur Baru</option><option value="Peningkatan Fitur" data-v-73ab937e>Peningkatan Fitur</option><option value="Optimasi Sistem" data-v-73ab937e>Optimasi Sistem</option><option value="UI/UX" data-v-73ab937e>UI/UX (Perbaikan Tampilan)</option><option value="Keamanan" data-v-73ab937e>Security (Keamanan)</option>',5)])],512),[[M,d.value.kategori_dev]])]),e("div",qt,[t[57]||(t[57]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Tingkat Urgensi",-1)),b(e("select",{"onUpdate:modelValue":t[12]||(t[12]=a=>d.value.urgensi=a),class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none transition-all"},[...t[56]||(t[56]=[e("option",{value:"Low"},"Low (Bisa Nanti)",-1),e("option",{value:"Medium"},"Medium (Standar)",-1),e("option",{value:"High"},"High (Penting)",-1),e("option",{value:"Critical"},"Critical (Sangat Mendesak)",-1)])],512),[[M,d.value.urgensi]])])]),e("div",Ft,[t[58]||(t[58]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Deskripsi Masukan",-1)),b(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=a=>d.value.deskripsi_masukan=a),rows:"2",class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none resize-none transition-all",placeholder:"Jelaskan gambaran umum fitur..."},null,512),[[h,d.value.deskripsi_masukan]])]),e("div",It,[e("div",Rt,[t[59]||(t[59]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Masalah & Dampak",-1)),e("div",Et,[b(e("textarea",{"onUpdate:modelValue":t[14]||(t[14]=a=>d.value.masalah=a),rows:"2",class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-xs text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none resize-none transition-all",placeholder:"Masalah..."},null,512),[[h,d.value.masalah]]),b(e("textarea",{"onUpdate:modelValue":t[15]||(t[15]=a=>d.value.dampak=a),rows:"2",class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-xs text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none resize-none transition-all",placeholder:"Dampak..."},null,512),[[h,d.value.dampak]])])]),e("div",Mt,[t[61]||(t[61]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Pelapor",-1)),b(e("select",{"onUpdate:modelValue":t[16]||(t[16]=a=>d.value.reporter_id=a),class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none transition-all"},[t[60]||(t[60]=e("option",{value:"",disabled:""},"-- Pilih Pelapor --",-1)),(i(!0),n(D,null,A(X.value,a=>(i(),n("option",{key:a.id,value:a.id},o(a.full_name||a.email||"Tanpa Nama")+" "+o(a.id===y(u).user?.id?"(Saya)":""),9,Tt))),128))],512),[[M,d.value.reporter_id]])])]),e("div",$t,[t[62]||(t[62]=e("label",{class:"text-[10px] font-bold text-slate-500 dark:text-slate-300 uppercase tracking-widest"},"Usulan Solusi & Link Lampiran",-1)),e("div",Lt,[b(e("textarea",{"onUpdate:modelValue":t[17]||(t[17]=a=>d.value.usulan=a),rows:"1",class:"w-full bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-2 text-xs text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none resize-none transition-all",placeholder:"Usulan solusi..."},null,512),[[h,d.value.usulan]]),e("div",Bt,[b(e("input",{"onUpdate:modelValue":t[18]||(t[18]=a=>d.value.attachment_wa=a),type:"url",class:"flex-1 bg-slate-50 dark:bg-[#1a1a1a] border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-2 text-xs text-slate-800 dark:text-white focus:ring-2 focus:ring-accent-emerald outline-none transition-all",placeholder:"Link lampiran (URL)"},null,512),[[h,d.value.attachment_wa]]),e("input",{type:"file",ref_key:"modalFileInput",ref:se,class:"hidden",onChange:t[19]||(t[19]=a=>F.value=a.target.files[0])},null,544),e("button",{type:"button",onClick:t[20]||(t[20]=a=>se.value?.click()),class:"bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 p-2 rounded-xl transition-all border border-slate-200 dark:border-white/10 flex items-center gap-2"},[e("span",Vt,o(F.value?"check_circle":"attach_file"),1),e("span",Kt,o(F.value?F.value.name:"File"),1)])])])])])],32)]),e("div",zt,[e("button",{onClick:t[21]||(t[21]=a=>C.value=!1),class:"text-slate-400 hover:text-slate-600 dark:text-slate-500 dark:hover:text-white text-xs font-bold uppercase tracking-widest transition-colors"},"Batal"),e("button",{type:"submit",form:"addFeatureForm",disabled:S.value,class:"bg-emerald-600 hover:bg-emerald-500 dark:bg-emerald-500 dark:hover:bg-emerald-400 disabled:opacity-50 text-white px-8 py-3 rounded-xl text-xs font-bold uppercase tracking-widest transition-all flex items-center gap-2 shadow-lg shadow-emerald-600/20 active:scale-95"},[S.value?(i(),n("span",Nt,"progress_activity")):x("",!0),t[64]||(t[64]=g(" Kirim Pengajuan ",-1))],8,Ot)])])])):x("",!0),P.value&&l.value?(i(),n("div",Ht,[e("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:t[22]||(t[22]=a=>P.value=!1)}),e("div",Gt,[e("header",Jt,[e("div",Qt,[t[65]||(t[65]=e("div",{class:"flex items-center gap-2 text-[10px] font-bold text-slate-500 dark:text-slate-500 uppercase tracking-widest mb-1"},[e("span",null,"Feature Request"),e("span",{class:"material-symbols-outlined text-[10px]"},"chevron_right"),e("span",{class:"text-accent-emerald"},"Detail Pengajuan")],-1)),e("div",Xt,[e("h2",Yt,o(l.value.judul_request),1),e("span",{class:m([Z(l.value.status_lifecycle),"status-badge px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider border shadow-sm"])},o(l.value.status_lifecycle),3)])]),e("div",Wt,[y(u).user?.role==="Super Admin"?(i(),n("button",{key:0,onClick:t[23]||(t[23]=a=>P.value=!1),class:"flex items-center gap-2 bg-white dark:bg-white/5 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-700 dark:text-white/80 px-4 py-2 rounded-lg font-bold text-sm transition-all border border-slate-200 dark:border-white/10 shadow-sm active:scale-95"},[...t[66]||(t[66]=[e("span",{class:"material-symbols-outlined text-lg"},"edit",-1),g(" Edit Request ",-1)])])):x("",!0),e("button",{onClick:t[24]||(t[24]=a=>P.value=!1),class:"text-slate-400 hover:text-slate-600 dark:text-slate-500 dark:hover:text-white transition-colors p-2 hover:bg-slate-100 dark:hover:bg-white/5 rounded-full"},[...t[67]||(t[67]=[e("span",{class:"material-symbols-outlined"},"close",-1)])])])]),e("div",Zt,[e("div",ea,[e("div",ta,[e("div",aa,[e("section",sa,[t[74]||(t[74]=e("h3",{class:"text-sm font-black text-slate-800 dark:text-white flex items-center gap-2 mb-6 pb-4 border-b border-slate-100 dark:border-gray-800"},[e("span",{class:"material-symbols-outlined text-accent-emerald text-xl"},"fingerprint"),g(" Identitas & Konteks ")],-1)),e("div",ra,[e("div",null,[t[68]||(t[68]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"Reporter",-1)),e("div",la,[e("img",{src:l.value.reporter?.avatar_url||"https://ui-avatars.com/api/?name="+l.value.reporter?.full_name,class:"w-6 h-6 rounded-full border border-slate-200 dark:border-white/10",alt:"Avatar"},null,8,oa),e("span",na,o(l.value.reporter?.full_name||"Unknown"),1)])]),e("div",null,[t[69]||(t[69]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"Tanggal Pengajuan",-1)),e("span",ia,o(new Date(l.value.created_at).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})),1)]),e("div",null,[t[70]||(t[70]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"Status Perwakilan",-1)),e("span",da,o(l.value.status_perwakilan)+" "+o(l.value.kode_pesantren?"("+l.value.kode_pesantren+")":""),1)]),e("div",null,[t[71]||(t[71]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"Unit Yayasan",-1)),e("span",ua,o(l.value.unit_yayasan||"-"),1)]),e("div",null,[t[72]||(t[72]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"App Name",-1)),e("span",ca,o(l.value.project?.name||"-"),1)]),e("div",null,[t[73]||(t[73]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"Kategori Modul",-1)),e("span",pa,o(l.value.component?.name||"-"),1)])])]),e("section",xa,[t[79]||(t[79]=e("h3",{class:"text-sm font-black text-slate-800 dark:text-white flex items-center gap-2 mb-6 pb-4 border-b border-slate-100 dark:border-gray-800"},[e("span",{class:"material-symbols-outlined text-accent-emerald text-xl"},"lightbulb"),g(" Detail Ide ")],-1)),e("div",ba,[e("div",null,[t[75]||(t[75]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"Judul Request",-1)),e("p",ga,o(l.value.judul_request),1)]),e("div",ma,[e("div",null,[t[77]||(t[77]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"Kategori Pengembangan",-1)),e("div",ka,[t[76]||(t[76]=e("span",{class:"material-symbols-outlined text-sm"},"extension",-1)),g(" "+o(l.value.kategori_dev),1)])])]),e("div",null,[t[78]||(t[78]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"Deskripsi Singkat",-1)),e("p",fa,o(l.value.deskripsi_masukan),1)])])]),e("section",va,[t[84]||(t[84]=e("h3",{class:"text-sm font-black text-slate-800 dark:text-white flex items-center gap-2 mb-6 pb-4 border-b border-slate-100 dark:border-gray-800"},[e("span",{class:"material-symbols-outlined text-accent-emerald text-xl"},"analytics"),g(" Analisis Strategis ")],-1)),e("div",ha,[e("div",null,[t[80]||(t[80]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"Problem Statement",-1)),e("div",wa,[e("p",_a,o(l.value.masalah),1)])]),e("div",null,[t[81]||(t[81]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"Proposed Solution",-1)),e("div",ya,[e("p",ja,o(l.value.usulan),1)])]),e("div",null,[t[83]||(t[83]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-1 block"},"Analisis Dampak",-1)),e("div",Sa,[e("div",Da,[t[82]||(t[82]=e("p",{class:"text-[10px] font-bold text-accent-emerald uppercase mb-1"},"Impact Analysis",-1)),e("p",Aa,o(l.value.dampak),1)])])])])])]),e("div",Ca,[e("div",{class:m(["bg-white dark:bg-[#111111] border border-slate-200 dark:border-gray-800 rounded-xl p-6 border-t-4 shadow-sm",je(l.value.urgensi)])},[t[86]||(t[86]=e("label",{class:"text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-3 block"},"Tingkat Urgensi",-1)),e("div",Pa,[e("div",{class:m(["w-12 h-12 rounded-xl flex items-center justify-center",ye(l.value.urgensi)])},[e("span",{class:m(["material-symbols-outlined text-3xl",ce(l.value.urgensi)])},"priority_high",2)],2),e("div",null,[e("p",{class:m(["text-xl font-black tracking-tight",ce(l.value.urgensi)])},o(l.value.urgensi?.toUpperCase()),3),t[85]||(t[85]=e("p",{class:"text-[11px] text-slate-400 dark:text-white/40 font-medium"},"Tingkat prioritas pengembangan",-1))])])],2),e("div",Ua,[t[91]||(t[91]=e("h3",{class:"text-sm font-black text-slate-800 dark:text-white mb-6"},"Timeline Status",-1)),e("div",qa,[e("div",Fa,[t[88]||(t[88]=e("div",{class:"absolute left-0 top-1 w-6 h-6 rounded-full bg-accent-emerald flex items-center justify-center shadow-[0_0_12px_rgba(16,185,129,0.4)]"},[e("span",{class:"material-symbols-outlined text-[14px] text-primary font-bold"},"check")],-1)),e("div",null,[t[87]||(t[87]=e("p",{class:"text-xs font-black text-slate-800 dark:text-white"},"Pengajuan Dibuat",-1)),e("p",Ia,o(new Date(l.value.created_at).toLocaleDateString("id-ID"))+" • Oleh "+o(l.value.reporter?.full_name),1)])]),l.value.status_lifecycle!=="Baru"?(i(),n("div",Ra,[t[89]||(t[89]=e("div",{class:"absolute left-0 top-1 w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center shadow-[0_0_12px_rgba(59,130,246,0.4)]"},[e("span",{class:"material-symbols-outlined text-[14px] text-white font-bold"},"visibility")],-1)),e("div",null,[e("p",Ea,o(l.value.status_lifecycle),1),e("p",Ma,o(new Date(l.value.updated_at).toLocaleDateString("id-ID"))+" • Sistem Auto",1)])])):x("",!0),l.value.status_lifecycle==="Baru"?(i(),n("div",Ta,[...t[90]||(t[90]=[e("div",{class:"absolute left-0 top-1 w-6 h-6 rounded-full bg-slate-100 dark:bg-white/10 border border-slate-200 dark:border-white/20 flex items-center justify-center"},[e("div",{class:"w-1.5 h-1.5 rounded-full bg-slate-300 dark:bg-white/20"})],-1),e("div",null,[e("p",{class:"text-xs font-black text-slate-300 dark:text-white/30"},"Langkah Berikutnya"),e("p",{class:"text-[10px] text-slate-200 dark:text-white/20 font-bold"},"Menunggu Peninjauan...")],-1)])])):x("",!0)])]),l.value.status_lifecycle==="Ditolak"?(i(),n("div",$a,[t[92]||(t[92]=e("h3",{class:"text-sm font-black text-red-500 dark:text-red-400 mb-3 flex items-center gap-2"},[e("span",{class:"material-symbols-outlined text-sm"},"error"),g(" Alasan Penolakan ")],-1)),e("p",La,o(l.value.alasan_penolakan||"Tidak ada alasan yang diberikan."),1)])):x("",!0),["Super Admin","Admin","Editor"].includes(y(u).user?.role)?(i(),n("div",Ba,[t[95]||(t[95]=e("h3",{class:"text-sm font-black text-slate-800 dark:text-white mb-4"},"Manajemen Status",-1)),e("div",Va,[(i(),n(D,null,A(["Baru","Sedang Ditinjau","Sedang Dipertimbangkan","Sedang Dikembangkan","Selesai"],a=>e("button",{key:a,onClick:r=>H(l.value.id,a),class:m(["w-full px-4 py-2 rounded-lg text-xs font-black transition-all text-left flex items-center justify-between group",l.value.status_lifecycle===a?"bg-accent-emerald text-[#032A28]":a==="Baru"?"bg-gray-600/10 text-gray-600 dark:bg-gray-400/10 dark:text-gray-400":"bg-slate-50 dark:bg-white/5 text-slate-500 dark:text-white/60 hover:bg-slate-100 dark:hover:bg-white/10"])},[g(o(a)+" ",1),l.value.status_lifecycle===a?(i(),n("span",za,"check_circle")):x("",!0)],10,Ka)),64)),e("button",{onClick:t[25]||(t[25]=a=>H(l.value.id,"Ditolak")),class:"w-full px-4 py-2 rounded-lg text-xs font-black transition-all text-left flex items-center justify-between mt-2 bg-red-50 dark:bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white"},[...t[93]||(t[93]=[g(" Tolak / Arsip ",-1),e("span",{class:"material-symbols-outlined text-sm"},"cancel",-1)])]),e("button",{onClick:t[26]||(t[26]=a=>_e(l.value.id)),class:"w-full px-4 py-2 rounded-lg text-xs font-black transition-all text-left flex items-center justify-between mt-4 border border-red-200 dark:border-red-500/20 text-red-400 dark:text-red-500/60 hover:bg-red-500 hover:text-white"},[...t[94]||(t[94]=[g(" Hapus Permanen ",-1),e("span",{class:"material-symbols-outlined text-sm"},"delete",-1)])])])])):x("",!0)]),e("div",Oa,[e("section",Na,[t[97]||(t[97]=e("h3",{class:"text-sm font-black text-slate-800 dark:text-white flex items-center gap-2 mb-6 pb-4 border-b border-slate-100 dark:border-gray-800"},[e("span",{class:"material-symbols-outlined text-accent-emerald text-xl"},"attachment"),g(" Lampiran Pendukung ")],-1)),e("div",Ha,[(i(!0),n(D,null,A(le.value,(a,r)=>(i(),n("a",{key:r,href:a.url,target:"_blank",class:"group relative"},[e("div",Ja,[e("span",Qa,o(a.type==="link"?"link":"description"),1)]),e("p",Xa,o(a.name),1),a.user?(i(),n("p",Ya,"Oleh: "+o(a.user),1)):x("",!0)],8,Ga))),128)),le.value.length===0?(i(),n("div",Wa,[...t[96]||(t[96]=[e("span",{class:"material-symbols-outlined text-slate-300 dark:text-white/10 text-3xl"},"inventory_2",-1),e("p",{class:"mt-2 text-[10px] text-slate-400 dark:text-white/20 font-bold uppercase tracking-widest"},"Tidak ada lampiran",-1)])])):x("",!0)])]),e("section",Za,[e("h3",es,[t[98]||(t[98]=e("span",{class:"material-symbols-outlined text-accent-emerald"},"forum",-1)),g(" Forum Diskusi Terpadu ("+o(V.value.length)+" Komentar) ",1)]),e("div",ts,[(i(!0),n(D,null,A(V.value,a=>(i(),n("div",{key:a.id,class:m(["flex gap-3",a.user_id===y(u).user?.id?"flex-row-reverse":"flex-row"])},[e("img",{src:a.user?.avatar_url||"https://ui-avatars.com/api/?name="+a.user?.full_name,class:"w-8 h-8 rounded-full border border-slate-200 dark:border-white/10 shrink-0 self-end mb-1",alt:"User"},null,8,as),e("div",{class:m(["max-w-[80%] flex flex-col",a.user_id===y(u).user?.id?"items-end":"items-start"])},[e("div",ss,[e("span",rs,o(a.user?.full_name),1),e("span",ls,o(a.user?.role),1)]),e("div",{class:m(["px-4 py-2.5 rounded-2xl text-sm shadow-sm relative group",a.user_id===y(u).user?.id?"bg-accent-emerald text-[#032A28] rounded-br-none font-bold":"bg-slate-50 dark:bg-white/5 text-slate-700 dark:text-white/90 border border-slate-100 dark:border-white/5 rounded-bl-none font-medium"])},[a.attachment_url?(i(),n("div",os,[e("a",{href:a.attachment_url,target:"_blank",class:"block group/media relative"},[a.attachment_url.match(/\.(jpg|jpeg|png|gif|webp)$/i)?(i(),n("img",{key:0,src:a.attachment_url,class:"w-full h-auto max-h-[300px] object-cover group-hover/media:scale-105 transition-transform duration-500"},null,8,is)):(i(),n("div",ds,[...t[99]||(t[99]=[pe('<div class="w-10 h-10 rounded-lg bg-white/20 dark:bg-white/5 flex items-center justify-center" data-v-73ab937e><span class="material-symbols-outlined text-2xl" data-v-73ab937e>description</span></div><div class="flex-1 min-w-0" data-v-73ab937e><p class="text-[11px] font-black truncate" data-v-73ab937e>Lampiran File</p><p class="text-[9px] opacity-60 font-bold uppercase tracking-tight" data-v-73ab937e>Klik untuk membuka</p></div><span class="material-symbols-outlined text-sm opacity-40" data-v-73ab937e>open_in_new</span>',3)])]))],8,ns)])):x("",!0),e("p",us,o(a.comment_text),1),e("span",{class:m(["text-[9px] mt-1 block opacity-60 font-bold",a.user_id===y(u).user?.id?"text-[#032A28]":"text-slate-400 dark:text-white/60"])},o(new Date(a.created_at).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})),3)],2)],2)],2))),128)),V.value.length===0?(i(),n("div",cs,[...t[100]||(t[100]=[e("span",{class:"material-symbols-outlined text-6xl text-slate-200 dark:text-white/10"},"chat_bubble",-1),e("p",{class:"text-xs mt-4 italic font-bold text-slate-400 dark:text-white/20"},"Belum ada diskusi untuk pengajuan ini.",-1)])])):x("",!0)]),e("div",ps,[w.value?(i(),n("div",xs,[e("div",bs,[t[101]||(t[101]=e("span",{class:"material-symbols-outlined text-accent-emerald"},"description",-1)),e("div",gs,[e("span",ms,o(w.value.name),1),e("span",ks,o((w.value.size/1024).toFixed(1))+" KB",1)])]),e("button",{onClick:ke,class:"text-slate-400 hover:text-red-500 transition-colors"},[...t[102]||(t[102]=[e("span",{class:"material-symbols-outlined text-lg"},"close",-1)])])])):x("",!0),e("div",fs,[e("div",vs,[b(e("textarea",{"onUpdate:modelValue":t[27]||(t[27]=a=>I.value=a),rows:"1",onInput:t[28]||(t[28]=a=>{a.target.style.height="auto",a.target.style.height=a.target.scrollHeight+"px"}),class:"w-full bg-transparent border-none px-3 py-2 text-sm text-slate-700 dark:text-white focus:ring-0 outline-none resize-none max-h-32 custom-scrollbar font-medium",placeholder:"Tulis tanggapan atau pertanyaan...",onKeyup:Ue(K(ie,["ctrl"]),["enter"])},null,40,hs),[[h,I.value]]),e("div",ws,[e("div",_s,[e("input",{type:"file",ref_key:"fileInput",ref:R,class:"hidden",onChange:me,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx"},null,544),e("button",{onClick:ge,class:"p-1.5 rounded-lg text-slate-400 dark:text-white/30 hover:text-accent-emerald hover:bg-accent-emerald/10 transition-all",title:"Unggah Media"},[...t[103]||(t[103]=[e("span",{class:"material-symbols-outlined text-xl"},"attach_file",-1)])]),t[104]||(t[104]=e("span",{class:"text-[9px] text-slate-400 dark:text-white/20 ml-2 font-bold uppercase tracking-tight"},"Ctrl + Enter untuk kirim",-1))]),e("button",{onClick:ie,disabled:O.value||!I.value.trim()&&!w.value,class:"bg-emerald-800 hover:bg-emerald-900 dark:bg-emerald-500 dark:hover:bg-emerald-400 disabled:opacity-30 text-white px-4 py-1.5 rounded-xl text-[10px] font-bold uppercase transition-all flex items-center gap-2 shadow-lg shadow-emerald-700/20 active:scale-95"},[O.value?(i(),n("span",js,"progress_activity")):(i(),n("span",Ss,"send")),t[105]||(t[105]=g(" Kirim ",-1))],8,ys)])])])])])])])])]),e("footer",Ds,[e("div",As,[t[106]||(t[106]=e("span",{class:"material-symbols-outlined text-slate-400 dark:text-white/20 text-sm"},"history",-1)),e("span",Cs,"Terakhir diperbarui: "+o(new Date(l.value.updated_at).toLocaleString("id-ID")),1)]),e("button",{onClick:t[29]||(t[29]=a=>P.value=!1),class:"bg-slate-200 dark:bg-white/10 hover:bg-slate-300 dark:hover:bg-white/20 text-slate-700 dark:text-white px-8 py-2.5 rounded-xl text-xs font-bold transition-all shadow-sm active:scale-95"},"Tutup Detail")])])])):x("",!0),q.value?(i(),n("div",Ps,[e("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:t[30]||(t[30]=a=>q.value=!1)}),e("div",Us,[t[107]||(t[107]=e("div",{class:"p-6 border-b border-slate-100 dark:border-gray-800 bg-slate-50 dark:bg-[#1a1a1a]/50"},[e("h3",{class:"text-lg font-black text-slate-800 dark:text-white flex items-center gap-2"},[e("span",{class:"material-symbols-outlined text-red-500"},"cancel"),g(" Alasan Penolakan ")]),e("p",{class:"text-[10px] text-slate-500 dark:text-slate-400 uppercase tracking-widest font-bold mt-1"},"Berikan alasan mengapa pengajuan ini ditolak")],-1)),e("div",qs,[b(e("textarea",{"onUpdate:modelValue":t[31]||(t[31]=a=>$.value=a),rows:"4",class:"w-full bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-gray-700 rounded-xl px-4 py-3 text-sm text-slate-800 dark:text-white focus:ring-2 focus:ring-red-500 outline-none resize-none transition-all font-medium",placeholder:"Contoh: Fitur sudah ada, tidak sesuai roadmap, atau keterbatasan resource..."},null,512),[[h,$.value]])]),e("div",Fs,[e("button",{onClick:t[32]||(t[32]=a=>q.value=!1),class:"text-slate-400 hover:text-slate-600 dark:text-slate-500 dark:hover:text-white text-xs font-bold uppercase tracking-widest transition-colors"},"Batal"),e("button",{onClick:t[33]||(t[33]=a=>H(l.value.id,"Ditolak")),disabled:!$.value.trim(),class:"bg-red-500 hover:bg-red-600 disabled:opacity-50 text-white px-6 py-2 rounded-xl text-xs font-bold transition-all shadow-lg shadow-red-500/20 active:scale-95"}," Konfirmasi Tolak ",8,Is)])])])):x("",!0)]))}},Ts=De(Rs,[["__scopeId","data-v-73ab937e"]]);export{Ts as default};
